PREHOOK: query: explain
with customer_total_return as
 (select wr_returning_customer_sk as ctr_customer_sk
        ,ca_state as ctr_state, 
 	sum(wr_return_amt) as ctr_total_return
 from web_returns
     ,date_dim
     ,customer_address
 where wr_returned_date_sk = d_date_sk 
   and d_year =2002
   and wr_returning_addr_sk = ca_address_sk 
 group by wr_returning_customer_sk
         ,ca_state)
  select  c_customer_id,c_salutation,c_first_name,c_last_name,c_preferred_cust_flag
       ,c_birth_day,c_birth_month,c_birth_year,c_birth_country,c_login,c_email_address
       ,c_last_review_date_sk,ctr_total_return
 from customer_total_return ctr1
     ,customer_address
     ,customer
 where ctr1.ctr_total_return > (select avg(ctr_total_return)*1.2
 			  from customer_total_return ctr2 
                  	  where ctr1.ctr_state = ctr2.ctr_state)
       and ca_address_sk = c_current_addr_sk
       and ca_state = 'IL'
       and ctr1.ctr_customer_sk = c_customer_sk
 order by c_customer_id,c_salutation,c_first_name,c_last_name,c_preferred_cust_flag
                  ,c_birth_day,c_birth_month,c_birth_year,c_birth_country,c_login,c_email_address
                  ,c_last_review_date_sk,ctr_total_return
limit 100
PREHOOK: type: QUERY
PREHOOK: Input: default@customer
PREHOOK: Input: default@customer_address
PREHOOK: Input: default@date_dim
PREHOOK: Input: default@web_returns
#### A masked pattern was here ####
POSTHOOK: query: explain
with customer_total_return as
 (select wr_returning_customer_sk as ctr_customer_sk
        ,ca_state as ctr_state, 
 	sum(wr_return_amt) as ctr_total_return
 from web_returns
     ,date_dim
     ,customer_address
 where wr_returned_date_sk = d_date_sk 
   and d_year =2002
   and wr_returning_addr_sk = ca_address_sk 
 group by wr_returning_customer_sk
         ,ca_state)
  select  c_customer_id,c_salutation,c_first_name,c_last_name,c_preferred_cust_flag
       ,c_birth_day,c_birth_month,c_birth_year,c_birth_country,c_login,c_email_address
       ,c_last_review_date_sk,ctr_total_return
 from customer_total_return ctr1
     ,customer_address
     ,customer
 where ctr1.ctr_total_return > (select avg(ctr_total_return)*1.2
 			  from customer_total_return ctr2 
                  	  where ctr1.ctr_state = ctr2.ctr_state)
       and ca_address_sk = c_current_addr_sk
       and ca_state = 'IL'
       and ctr1.ctr_customer_sk = c_customer_sk
 order by c_customer_id,c_salutation,c_first_name,c_last_name,c_preferred_cust_flag
                  ,c_birth_day,c_birth_month,c_birth_year,c_birth_country,c_login,c_email_address
                  ,c_last_review_date_sk,ctr_total_return
limit 100
POSTHOOK: type: QUERY
POSTHOOK: Input: default@customer
POSTHOOK: Input: default@customer_address
POSTHOOK: Input: default@date_dim
POSTHOOK: Input: default@web_returns
#### A masked pattern was here ####
STAGE DEPENDENCIES:
  Stage-0 is a root stage

STAGE PLANS:
  Stage: Stage-0
    Fetch Operator
      limit: -1
      Processor Tree:
        TableScan
          alias: customer
          properties:
            hive.sql.query SELECT "t32"."c_customer_id", "t32"."c_salutation", "t32"."c_first_name", "t32"."c_last_name", "t32"."c_preferred_cust_flag", "t32"."c_birth_day", "t32"."c_birth_month", "t32"."c_birth_year", "t32"."c_birth_country", "t32"."c_login", "t32"."c_email_address", "t32"."c_last_review_date_sk", "t32"."ctr_total_return"
FROM (SELECT "t1"."c_customer_id", "t1"."c_salutation", "t1"."c_first_name", "t1"."c_last_name", "t1"."c_preferred_cust_flag", "t1"."c_birth_day", "t1"."c_birth_month", "t1"."c_birth_year", "t1"."c_birth_country", "t1"."c_login", "t1"."c_email_address", "t1"."c_last_review_date_sk", "t30"."$f2" AS "ctr_total_return"
FROM (SELECT "c_customer_sk", "c_customer_id", "c_current_addr_sk", "c_salutation", "c_first_name", "c_last_name", "c_preferred_cust_flag", "c_birth_day", "c_birth_month", "c_birth_year", "c_birth_country", "c_login", "c_email_address", "c_last_review_date_sk"
FROM (SELECT "c_customer_sk", "c_customer_id", "c_current_addr_sk", "c_salutation", "c_first_name", "c_last_name", "c_preferred_cust_flag", "c_birth_day", "c_birth_month", "c_birth_year", "c_birth_country", "c_login", "c_email_address", "c_last_review_date_sk"
FROM "customer") AS "t"
WHERE "c_current_addr_sk" IS NOT NULL AND "c_customer_sk" IS NOT NULL) AS "t1"
INNER JOIN (SELECT "ca_address_sk"
FROM (SELECT "ca_address_sk", "ca_state"
FROM "customer_address") AS "t2"
WHERE "ca_state" = 'IL' AND "ca_address_sk" IS NOT NULL) AS "t4" ON "t1"."c_current_addr_sk" = "t4"."ca_address_sk"
INNER JOIN (SELECT "t16"."wr_returning_customer_sk", "t16"."ca_state", "t16"."$f2", "t29"."_o__c0", "t29"."ctr_state"
FROM (SELECT "t7"."wr_returning_customer_sk", "t13"."ca_state", SUM("t7"."wr_return_amt") AS "$f2"
FROM (SELECT "wr_returned_date_sk", "wr_returning_customer_sk", "wr_returning_addr_sk", "wr_return_amt"
FROM (SELECT "wr_returned_date_sk", "wr_returning_customer_sk", "wr_returning_addr_sk", "wr_return_amt"
FROM "web_returns") AS "t5"
WHERE "wr_returned_date_sk" IS NOT NULL AND ("wr_returning_addr_sk" IS NOT NULL AND "wr_returning_customer_sk" IS NOT NULL)) AS "t7"
INNER JOIN (SELECT "d_date_sk"
FROM (SELECT "d_date_sk", "d_year"
FROM "date_dim") AS "t8"
WHERE "d_year" = 2002 AND "d_date_sk" IS NOT NULL) AS "t10" ON "t7"."wr_returned_date_sk" = "t10"."d_date_sk"
INNER JOIN (SELECT "ca_address_sk", "ca_state"
FROM (SELECT "ca_address_sk", "ca_state"
FROM "customer_address") AS "t11"
WHERE "ca_address_sk" IS NOT NULL AND "ca_state" IS NOT NULL) AS "t13" ON "t7"."wr_returning_addr_sk" = "t13"."ca_address_sk"
GROUP BY "t7"."wr_returning_customer_sk", "t13"."ca_state"
HAVING SUM("t7"."wr_return_amt") IS NOT NULL) AS "t16"
INNER JOIN (SELECT CAST(SUM("t26"."$f2") / COUNT("t26"."$f2") AS DECIMAL(21, 6)) * 1.2 AS "_o__c0", "t26"."ca_state" AS "ctr_state"
FROM (SELECT "t19"."wr_returning_customer_sk", "t25"."ca_state", SUM("t19"."wr_return_amt") AS "$f2"
FROM (SELECT "wr_returned_date_sk", "wr_returning_customer_sk", "wr_returning_addr_sk", "wr_return_amt"
FROM (SELECT "wr_returned_date_sk", "wr_returning_customer_sk", "wr_returning_addr_sk", "wr_return_amt"
FROM "web_returns") AS "t17"
WHERE "wr_returned_date_sk" IS NOT NULL AND "wr_returning_addr_sk" IS NOT NULL) AS "t19"
INNER JOIN (SELECT "d_date_sk"
FROM (SELECT "d_date_sk", "d_year"
FROM "date_dim") AS "t20"
WHERE "d_year" = 2002 AND "d_date_sk" IS NOT NULL) AS "t22" ON "t19"."wr_returned_date_sk" = "t22"."d_date_sk"
INNER JOIN (SELECT "ca_address_sk", "ca_state"
FROM (SELECT "ca_address_sk", "ca_state"
FROM "customer_address") AS "t23"
WHERE "ca_address_sk" IS NOT NULL AND "ca_state" IS NOT NULL) AS "t25" ON "t19"."wr_returning_addr_sk" = "t25"."ca_address_sk"
GROUP BY "t19"."wr_returning_customer_sk", "t25"."ca_state") AS "t26"
GROUP BY "t26"."ca_state"
HAVING CAST(SUM("t26"."$f2") / COUNT("t26"."$f2") AS DECIMAL(21, 6)) IS NOT NULL) AS "t29" ON "t16"."ca_state" = "t29"."ctr_state" AND "t16"."$f2" > "t29"."_o__c0") AS "t30" ON "t1"."c_customer_sk" = "t30"."wr_returning_customer_sk"
ORDER BY "t1"."c_customer_id", "t1"."c_salutation", "t1"."c_first_name", "t1"."c_last_name", "t1"."c_preferred_cust_flag", "t1"."c_birth_day", "t1"."c_birth_month", "t1"."c_birth_year", "t1"."c_birth_country", "t1"."c_login", "t1"."c_email_address", "t1"."c_last_review_date_sk", "t30"."$f2"
FETCH NEXT 100 ROWS ONLY) AS "t32"
            hive.sql.query.fieldNames c_customer_id,c_salutation,c_first_name,c_last_name,c_preferred_cust_flag,c_birth_day,c_birth_month,c_birth_year,c_birth_country,c_login,c_email_address,c_last_review_date_sk,ctr_total_return
            hive.sql.query.fieldTypes string,string,string,string,string,int,int,int,string,string,string,string,decimal(17,2)
            hive.sql.query.split false
          Select Operator
            expressions: c_customer_id (type: string), c_salutation (type: string), c_first_name (type: string), c_last_name (type: string), c_preferred_cust_flag (type: string), c_birth_day (type: int), c_birth_month (type: int), c_birth_year (type: int), c_birth_country (type: string), c_login (type: string), c_email_address (type: string), c_last_review_date_sk (type: string), ctr_total_return (type: decimal(17,2))
            outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5, _col6, _col7, _col8, _col9, _col10, _col11, _col12
            ListSink

