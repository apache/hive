CTE Suggestion:
JdbcFilter(condition=[AND(IS NOT NULL($0), IS NOT NULL($1))])
  JdbcProject(ca_address_sk=[$0], ca_county=[$7])
    JdbcHiveTableScan(table=[[default, customer_address]], table:alias=[customer_address])

CTE Suggestion:
JdbcFilter(condition=[AND(IS NOT NULL($0), IS NOT NULL($1))])
  JdbcProject(ss_sold_date_sk=[$0], ss_addr_sk=[$6], ss_ext_sales_price=[$15])
    JdbcHiveTableScan(table=[[default, store_sales]], table:alias=[store_sales])

CTE Suggestion:
JdbcFilter(condition=[AND(IS NOT NULL($0), IS NOT NULL($1))])
  JdbcProject(ws_sold_date_sk=[$0], ws_bill_addr_sk=[$7], ws_ext_sales_price=[$23])
    JdbcHiveTableScan(table=[[default, web_sales]], table:alias=[web_sales])

CTE Suggestion:
JdbcProject(d_date_sk=[$0])
  JdbcFilter(condition=[AND(=($2, 1), =($1, 2000), IS NOT NULL($0))])
    JdbcProject(d_date_sk=[$0], d_year=[$6], d_qoy=[$10])
      JdbcHiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])

CTE Suggestion:
JdbcProject(d_date_sk=[$0])
  JdbcFilter(condition=[AND(=($2, 2), =($1, 2000), IS NOT NULL($0))])
    JdbcProject(d_date_sk=[$0], d_year=[$6], d_qoy=[$10])
      JdbcHiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])

CTE Suggestion:
JdbcProject(d_date_sk=[$0])
  JdbcFilter(condition=[AND(=($2, 3), =($1, 2000), IS NOT NULL($0))])
    JdbcProject(d_date_sk=[$0], d_year=[$6], d_qoy=[$10])
      JdbcHiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])

PREHOOK: query: explain cbo
with ss as
 (select ca_county,d_qoy, d_year,sum(ss_ext_sales_price) as store_sales
 from store_sales,date_dim,customer_address
 where ss_sold_date_sk = d_date_sk
  and ss_addr_sk=ca_address_sk
 group by ca_county,d_qoy, d_year),
 ws as
 (select ca_county,d_qoy, d_year,sum(ws_ext_sales_price) as web_sales
 from web_sales,date_dim,customer_address
 where ws_sold_date_sk = d_date_sk
  and ws_bill_addr_sk=ca_address_sk
 group by ca_county,d_qoy, d_year)
 select /* tt */
        ss1.ca_county
       ,ss1.d_year
       ,ws2.web_sales/ws1.web_sales web_q1_q2_increase
       ,ss2.store_sales/ss1.store_sales store_q1_q2_increase
       ,ws3.web_sales/ws2.web_sales web_q2_q3_increase
       ,ss3.store_sales/ss2.store_sales store_q2_q3_increase
 from
        ss ss1
       ,ss ss2
       ,ss ss3
       ,ws ws1
       ,ws ws2
       ,ws ws3
 where
    ss1.d_qoy = 1
    and ss1.d_year = 2000
    and ss1.ca_county = ss2.ca_county
    and ss2.d_qoy = 2
    and ss2.d_year = 2000
 and ss2.ca_county = ss3.ca_county
    and ss3.d_qoy = 3
    and ss3.d_year = 2000
    and ss1.ca_county = ws1.ca_county
    and ws1.d_qoy = 1
    and ws1.d_year = 2000
    and ws1.ca_county = ws2.ca_county
    and ws2.d_qoy = 2
    and ws2.d_year = 2000
    and ws1.ca_county = ws3.ca_county
    and ws3.d_qoy = 3
    and ws3.d_year =2000
    and case when ws1.web_sales > 0 then ws2.web_sales/ws1.web_sales else null end 
       > case when ss1.store_sales > 0 then ss2.store_sales/ss1.store_sales else null end
    and case when ws2.web_sales > 0 then ws3.web_sales/ws2.web_sales else null end
       > case when ss2.store_sales > 0 then ss3.store_sales/ss2.store_sales else null end
 order by ss1.d_year
PREHOOK: type: QUERY
PREHOOK: Input: default@customer_address
PREHOOK: Input: default@date_dim
PREHOOK: Input: default@store_sales
PREHOOK: Input: default@web_sales
#### A masked pattern was here ####
POSTHOOK: query: explain cbo
with ss as
 (select ca_county,d_qoy, d_year,sum(ss_ext_sales_price) as store_sales
 from store_sales,date_dim,customer_address
 where ss_sold_date_sk = d_date_sk
  and ss_addr_sk=ca_address_sk
 group by ca_county,d_qoy, d_year),
 ws as
 (select ca_county,d_qoy, d_year,sum(ws_ext_sales_price) as web_sales
 from web_sales,date_dim,customer_address
 where ws_sold_date_sk = d_date_sk
  and ws_bill_addr_sk=ca_address_sk
 group by ca_county,d_qoy, d_year)
 select /* tt */
        ss1.ca_county
       ,ss1.d_year
       ,ws2.web_sales/ws1.web_sales web_q1_q2_increase
       ,ss2.store_sales/ss1.store_sales store_q1_q2_increase
       ,ws3.web_sales/ws2.web_sales web_q2_q3_increase
       ,ss3.store_sales/ss2.store_sales store_q2_q3_increase
 from
        ss ss1
       ,ss ss2
       ,ss ss3
       ,ws ws1
       ,ws ws2
       ,ws ws3
 where
    ss1.d_qoy = 1
    and ss1.d_year = 2000
    and ss1.ca_county = ss2.ca_county
    and ss2.d_qoy = 2
    and ss2.d_year = 2000
 and ss2.ca_county = ss3.ca_county
    and ss3.d_qoy = 3
    and ss3.d_year = 2000
    and ss1.ca_county = ws1.ca_county
    and ws1.d_qoy = 1
    and ws1.d_year = 2000
    and ws1.ca_county = ws2.ca_county
    and ws2.d_qoy = 2
    and ws2.d_year = 2000
    and ws1.ca_county = ws3.ca_county
    and ws3.d_qoy = 3
    and ws3.d_year =2000
    and case when ws1.web_sales > 0 then ws2.web_sales/ws1.web_sales else null end 
       > case when ss1.store_sales > 0 then ss2.store_sales/ss1.store_sales else null end
    and case when ws2.web_sales > 0 then ws3.web_sales/ws2.web_sales else null end
       > case when ss2.store_sales > 0 then ss3.store_sales/ss2.store_sales else null end
 order by ss1.d_year
POSTHOOK: type: QUERY
POSTHOOK: Input: default@customer_address
POSTHOOK: Input: default@date_dim
POSTHOOK: Input: default@store_sales
POSTHOOK: Input: default@web_sales
#### A masked pattern was here ####
CBO PLAN:
HiveJdbcConverter(convention=[JDBC.POSTGRES])
  JdbcProject(ca_county=[$8], d_year=[CAST(2000):INTEGER], web_q1_q2_increase=[/($6, $1)], store_q1_q2_increase=[/($11, $9)], web_q2_q3_increase=[/($4, $6)], store_q2_q3_increase=[/($13, $11)])
    JdbcJoin(condition=[AND(=($8, $0), CASE(>($9, 0:DECIMAL(1, 0)), CASE($2, >(/($6, $1), /($11, $9)), false), false), CASE(>($11, 0:DECIMAL(1, 0)), CASE($7, >(/($4, $6), /($13, $11)), false), false))], joinType=[inner])
      JdbcJoin(condition=[=($0, $5)], joinType=[inner])
        JdbcJoin(condition=[=($0, $3)], joinType=[inner])
          JdbcProject($f0=[$0], $f3=[$1], >=[>($1, 0:DECIMAL(1, 0))])
            JdbcAggregate(group=[{5}], agg#0=[sum($2)])
              JdbcJoin(condition=[=($1, $4)], joinType=[inner])
                JdbcJoin(condition=[=($0, $3)], joinType=[inner])
                  JdbcProject(ws_sold_date_sk=[$0], ws_bill_addr_sk=[$1], ws_ext_sales_price=[$2])
                    JdbcFilter(condition=[AND(IS NOT NULL($0), IS NOT NULL($1))])
                      JdbcProject(ws_sold_date_sk=[$0], ws_bill_addr_sk=[$7], ws_ext_sales_price=[$23])
                        JdbcHiveTableScan(table=[[default, web_sales]], table:alias=[web_sales])
                  JdbcProject(d_date_sk=[$0])
                    JdbcFilter(condition=[AND(=($2, 1), =($1, 2000), IS NOT NULL($0))])
                      JdbcProject(d_date_sk=[$0], d_year=[$6], d_qoy=[$10])
                        JdbcHiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
                JdbcProject(ca_address_sk=[$0], ca_county=[$1])
                  JdbcFilter(condition=[AND(IS NOT NULL($0), IS NOT NULL($1))])
                    JdbcProject(ca_address_sk=[$0], ca_county=[$7])
                      JdbcHiveTableScan(table=[[default, customer_address]], table:alias=[customer_address])
          JdbcAggregate(group=[{5}], agg#0=[sum($2)])
            JdbcJoin(condition=[=($1, $4)], joinType=[inner])
              JdbcJoin(condition=[=($0, $3)], joinType=[inner])
                JdbcProject(ws_sold_date_sk=[$0], ws_bill_addr_sk=[$1], ws_ext_sales_price=[$2])
                  JdbcFilter(condition=[AND(IS NOT NULL($0), IS NOT NULL($1))])
                    JdbcProject(ws_sold_date_sk=[$0], ws_bill_addr_sk=[$7], ws_ext_sales_price=[$23])
                      JdbcHiveTableScan(table=[[default, web_sales]], table:alias=[web_sales])
                JdbcProject(d_date_sk=[$0])
                  JdbcFilter(condition=[AND(=($2, 3), =($1, 2000), IS NOT NULL($0))])
                    JdbcProject(d_date_sk=[$0], d_year=[$6], d_qoy=[$10])
                      JdbcHiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
              JdbcProject(ca_address_sk=[$0], ca_county=[$1])
                JdbcFilter(condition=[AND(IS NOT NULL($0), IS NOT NULL($1))])
                  JdbcProject(ca_address_sk=[$0], ca_county=[$7])
                    JdbcHiveTableScan(table=[[default, customer_address]], table:alias=[customer_address])
        JdbcProject($f0=[$0], $f3=[$1], >=[>($1, 0:DECIMAL(1, 0))])
          JdbcAggregate(group=[{5}], agg#0=[sum($2)])
            JdbcJoin(condition=[=($1, $4)], joinType=[inner])
              JdbcJoin(condition=[=($0, $3)], joinType=[inner])
                JdbcProject(ws_sold_date_sk=[$0], ws_bill_addr_sk=[$1], ws_ext_sales_price=[$2])
                  JdbcFilter(condition=[AND(IS NOT NULL($0), IS NOT NULL($1))])
                    JdbcProject(ws_sold_date_sk=[$0], ws_bill_addr_sk=[$7], ws_ext_sales_price=[$23])
                      JdbcHiveTableScan(table=[[default, web_sales]], table:alias=[web_sales])
                JdbcProject(d_date_sk=[$0])
                  JdbcFilter(condition=[AND(=($2, 2), =($1, 2000), IS NOT NULL($0))])
                    JdbcProject(d_date_sk=[$0], d_year=[$6], d_qoy=[$10])
                      JdbcHiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
              JdbcProject(ca_address_sk=[$0], ca_county=[$1])
                JdbcFilter(condition=[AND(IS NOT NULL($0), IS NOT NULL($1))])
                  JdbcProject(ca_address_sk=[$0], ca_county=[$7])
                    JdbcHiveTableScan(table=[[default, customer_address]], table:alias=[customer_address])
      JdbcProject(ca_county=[$0], $f1=[$1], ca_county0=[$2], $f10=[$3], ca_county1=[$4], $f11=[$5])
        JdbcJoin(condition=[=($2, $4)], joinType=[inner])
          JdbcJoin(condition=[=($0, $2)], joinType=[inner])
            JdbcAggregate(group=[{5}], agg#0=[sum($2)])
              JdbcJoin(condition=[=($1, $4)], joinType=[inner])
                JdbcJoin(condition=[=($0, $3)], joinType=[inner])
                  JdbcProject(ss_sold_date_sk=[$0], ss_addr_sk=[$1], ss_ext_sales_price=[$2])
                    JdbcFilter(condition=[AND(IS NOT NULL($0), IS NOT NULL($1))])
                      JdbcProject(ss_sold_date_sk=[$0], ss_addr_sk=[$6], ss_ext_sales_price=[$15])
                        JdbcHiveTableScan(table=[[default, store_sales]], table:alias=[store_sales])
                  JdbcProject(d_date_sk=[$0])
                    JdbcFilter(condition=[AND(=($2, 1), =($1, 2000), IS NOT NULL($0))])
                      JdbcProject(d_date_sk=[$0], d_year=[$6], d_qoy=[$10])
                        JdbcHiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
                JdbcProject(ca_address_sk=[$0], ca_county=[$1])
                  JdbcFilter(condition=[AND(IS NOT NULL($0), IS NOT NULL($1))])
                    JdbcProject(ca_address_sk=[$0], ca_county=[$7])
                      JdbcHiveTableScan(table=[[default, customer_address]], table:alias=[customer_address])
            JdbcAggregate(group=[{5}], agg#0=[sum($2)])
              JdbcJoin(condition=[=($1, $4)], joinType=[inner])
                JdbcJoin(condition=[=($0, $3)], joinType=[inner])
                  JdbcProject(ss_sold_date_sk=[$0], ss_addr_sk=[$1], ss_ext_sales_price=[$2])
                    JdbcFilter(condition=[AND(IS NOT NULL($0), IS NOT NULL($1))])
                      JdbcProject(ss_sold_date_sk=[$0], ss_addr_sk=[$6], ss_ext_sales_price=[$15])
                        JdbcHiveTableScan(table=[[default, store_sales]], table:alias=[store_sales])
                  JdbcProject(d_date_sk=[$0])
                    JdbcFilter(condition=[AND(=($2, 2), =($1, 2000), IS NOT NULL($0))])
                      JdbcProject(d_date_sk=[$0], d_year=[$6], d_qoy=[$10])
                        JdbcHiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
                JdbcProject(ca_address_sk=[$0], ca_county=[$1])
                  JdbcFilter(condition=[AND(IS NOT NULL($0), IS NOT NULL($1))])
                    JdbcProject(ca_address_sk=[$0], ca_county=[$7])
                      JdbcHiveTableScan(table=[[default, customer_address]], table:alias=[customer_address])
          JdbcAggregate(group=[{5}], agg#0=[sum($2)])
            JdbcJoin(condition=[=($1, $4)], joinType=[inner])
              JdbcJoin(condition=[=($0, $3)], joinType=[inner])
                JdbcProject(ss_sold_date_sk=[$0], ss_addr_sk=[$1], ss_ext_sales_price=[$2])
                  JdbcFilter(condition=[AND(IS NOT NULL($0), IS NOT NULL($1))])
                    JdbcProject(ss_sold_date_sk=[$0], ss_addr_sk=[$6], ss_ext_sales_price=[$15])
                      JdbcHiveTableScan(table=[[default, store_sales]], table:alias=[store_sales])
                JdbcProject(d_date_sk=[$0])
                  JdbcFilter(condition=[AND(=($2, 3), =($1, 2000), IS NOT NULL($0))])
                    JdbcProject(d_date_sk=[$0], d_year=[$6], d_qoy=[$10])
                      JdbcHiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
              JdbcProject(ca_address_sk=[$0], ca_county=[$1])
                JdbcFilter(condition=[AND(IS NOT NULL($0), IS NOT NULL($1))])
                  JdbcProject(ca_address_sk=[$0], ca_county=[$7])
                    JdbcHiveTableScan(table=[[default, customer_address]], table:alias=[customer_address])

