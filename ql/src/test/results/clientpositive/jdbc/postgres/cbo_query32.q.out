CTE Suggestion:
JdbcProject(d_date_sk=[$0])
  JdbcFilter(condition=[AND(BETWEEN(false, CAST($1):TIMESTAMP(9), 1998-03-18 00:00:00:TIMESTAMP(9), 1998-06-16 00:00:00:TIMESTAMP(9)), IS NOT NULL($0))])
    JdbcProject(d_date_sk=[$0], d_date=[$2])
      JdbcHiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])

PREHOOK: query: explain cbo
select  sum(cs_ext_discount_amt)  as `excess discount amount` 
from 
   catalog_sales 
   ,item 
   ,date_dim
where
i_manufact_id = 269
and i_item_sk = cs_item_sk 
and d_date between '1998-03-18' and 
        (cast('1998-03-18' as date) + 90 days)
and d_date_sk = cs_sold_date_sk 
and cs_ext_discount_amt  
     > ( 
         select 
            1.3 * avg(cs_ext_discount_amt) 
         from 
            catalog_sales 
           ,date_dim
         where 
              cs_item_sk = i_item_sk 
          and d_date between '1998-03-18' and
                             (cast('1998-03-18' as date) + 90 days)
          and d_date_sk = cs_sold_date_sk 
      ) 
limit 100
PREHOOK: type: QUERY
PREHOOK: Input: default@catalog_sales
PREHOOK: Input: default@date_dim
PREHOOK: Input: default@item
#### A masked pattern was here ####
POSTHOOK: query: explain cbo
select  sum(cs_ext_discount_amt)  as `excess discount amount` 
from 
   catalog_sales 
   ,item 
   ,date_dim
where
i_manufact_id = 269
and i_item_sk = cs_item_sk 
and d_date between '1998-03-18' and 
        (cast('1998-03-18' as date) + 90 days)
and d_date_sk = cs_sold_date_sk 
and cs_ext_discount_amt  
     > ( 
         select 
            1.3 * avg(cs_ext_discount_amt) 
         from 
            catalog_sales 
           ,date_dim
         where 
              cs_item_sk = i_item_sk 
          and d_date between '1998-03-18' and
                             (cast('1998-03-18' as date) + 90 days)
          and d_date_sk = cs_sold_date_sk 
      ) 
limit 100
POSTHOOK: type: QUERY
POSTHOOK: Input: default@catalog_sales
POSTHOOK: Input: default@date_dim
POSTHOOK: Input: default@item
#### A masked pattern was here ####
CBO PLAN:
HiveJdbcConverter(convention=[JDBC.POSTGRES])
  JdbcAggregate(group=[{}], agg#0=[sum($2)])
    JdbcJoin(condition=[AND(=($6, $3), >($2, $5))], joinType=[inner])
      JdbcJoin(condition=[=($4, $0)], joinType=[inner])
        JdbcJoin(condition=[=($3, $1)], joinType=[inner])
          JdbcProject(cs_sold_date_sk=[$0], cs_item_sk=[$1], cs_ext_discount_amt=[$2])
            JdbcFilter(condition=[AND(IS NOT NULL($1), IS NOT NULL($0), IS NOT NULL($2))])
              JdbcProject(cs_sold_date_sk=[$0], cs_item_sk=[$15], cs_ext_discount_amt=[$22])
                JdbcHiveTableScan(table=[[default, catalog_sales]], table:alias=[catalog_sales])
          JdbcProject(i_item_sk=[$0])
            JdbcFilter(condition=[AND(=($1, 269), IS NOT NULL($0))])
              JdbcProject(i_item_sk=[$0], i_manufact_id=[$13])
                JdbcHiveTableScan(table=[[default, item]], table:alias=[item])
        JdbcProject(d_date_sk=[$0])
          JdbcFilter(condition=[AND(BETWEEN(false, CAST($1):TIMESTAMP(9), 1998-03-18 00:00:00:TIMESTAMP(9), 1998-06-16 00:00:00:TIMESTAMP(9)), IS NOT NULL($0))])
            JdbcProject(d_date_sk=[$0], d_date=[$2])
              JdbcHiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
      JdbcProject(_o__c0=[*(1.3:DECIMAL(2, 1), CAST(/($1, $2)):DECIMAL(11, 6))], cs_item_sk=[$0])
        JdbcFilter(condition=[IS NOT NULL(CAST(/($1, $2)):DECIMAL(11, 6))])
          JdbcAggregate(group=[{1}], agg#0=[sum($2)], agg#1=[count($2)])
            JdbcJoin(condition=[=($3, $0)], joinType=[inner])
              JdbcProject(cs_sold_date_sk=[$0], cs_item_sk=[$1], cs_ext_discount_amt=[$2])
                JdbcFilter(condition=[AND(IS NOT NULL($1), IS NOT NULL($0))])
                  JdbcProject(cs_sold_date_sk=[$0], cs_item_sk=[$15], cs_ext_discount_amt=[$22])
                    JdbcHiveTableScan(table=[[default, catalog_sales]], table:alias=[catalog_sales])
              JdbcProject(d_date_sk=[$0])
                JdbcFilter(condition=[AND(BETWEEN(false, CAST($1):TIMESTAMP(9), 1998-03-18 00:00:00:TIMESTAMP(9), 1998-06-16 00:00:00:TIMESTAMP(9)), IS NOT NULL($0))])
                  JdbcProject(d_date_sk=[$0], d_date=[$2])
                    JdbcHiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])

