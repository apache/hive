CTE Suggestion:
JdbcFilter(condition=[IS NOT NULL($1)])
  JdbcProject(ws_warehouse_sk=[$15], ws_order_number=[$17])
    JdbcHiveTableScan(table=[[default, web_sales]], table:alias=[ws1])

CTE Suggestion:
JdbcFilter(condition=[IS NOT NULL($1)])
  JdbcProject(ws_warehouse_sk=[$15], ws_order_number=[$17])
    JdbcHiveTableScan(table=[[default, web_sales]], table:alias=[ws2])

PREHOOK: query: explain cbo
with ws_wh as
(select ws1.ws_order_number,ws1.ws_warehouse_sk wh1,ws2.ws_warehouse_sk wh2
 from web_sales ws1,web_sales ws2
 where ws1.ws_order_number = ws2.ws_order_number
   and ws1.ws_warehouse_sk <> ws2.ws_warehouse_sk)
 select  
   count(distinct ws_order_number) as `order count`
  ,sum(ws_ext_ship_cost) as `total shipping cost`
  ,sum(ws_net_profit) as `total net profit`
from
   web_sales ws1
  ,date_dim
  ,customer_address
  ,web_site
where
    d_date between '1999-5-01' and 
           (cast('1999-5-01' as date) + 60 days)
and ws1.ws_ship_date_sk = d_date_sk
and ws1.ws_ship_addr_sk = ca_address_sk
and ca_state = 'TX'
and ws1.ws_web_site_sk = web_site_sk
and web_company_name = 'pri'
and ws1.ws_order_number in (select ws_order_number
                            from ws_wh)
and ws1.ws_order_number in (select wr_order_number
                            from web_returns,ws_wh
                            where wr_order_number = ws_wh.ws_order_number)
order by count(distinct ws_order_number)
limit 100
PREHOOK: type: QUERY
PREHOOK: Input: default@customer_address
PREHOOK: Input: default@date_dim
PREHOOK: Input: default@web_returns
PREHOOK: Input: default@web_sales
PREHOOK: Input: default@web_site
#### A masked pattern was here ####
POSTHOOK: query: explain cbo
with ws_wh as
(select ws1.ws_order_number,ws1.ws_warehouse_sk wh1,ws2.ws_warehouse_sk wh2
 from web_sales ws1,web_sales ws2
 where ws1.ws_order_number = ws2.ws_order_number
   and ws1.ws_warehouse_sk <> ws2.ws_warehouse_sk)
 select  
   count(distinct ws_order_number) as `order count`
  ,sum(ws_ext_ship_cost) as `total shipping cost`
  ,sum(ws_net_profit) as `total net profit`
from
   web_sales ws1
  ,date_dim
  ,customer_address
  ,web_site
where
    d_date between '1999-5-01' and 
           (cast('1999-5-01' as date) + 60 days)
and ws1.ws_ship_date_sk = d_date_sk
and ws1.ws_ship_addr_sk = ca_address_sk
and ca_state = 'TX'
and ws1.ws_web_site_sk = web_site_sk
and web_company_name = 'pri'
and ws1.ws_order_number in (select ws_order_number
                            from ws_wh)
and ws1.ws_order_number in (select wr_order_number
                            from web_returns,ws_wh
                            where wr_order_number = ws_wh.ws_order_number)
order by count(distinct ws_order_number)
limit 100
POSTHOOK: type: QUERY
POSTHOOK: Input: default@customer_address
POSTHOOK: Input: default@date_dim
POSTHOOK: Input: default@web_returns
POSTHOOK: Input: default@web_sales
POSTHOOK: Input: default@web_site
#### A masked pattern was here ####
CBO PLAN:
HiveAggregate(group=[{}], agg#0=[count(DISTINCT $3)], agg#1=[sum($4)], agg#2=[sum($5)])
  HiveSemiJoin(condition=[=($3, $12)], joinType=[semi])
    HiveSemiJoin(condition=[=($3, $12)], joinType=[semi])
      HiveProject(ws_ship_date_sk=[$0], ws_ship_addr_sk=[$1], ws_web_site_sk=[$2], ws_order_number=[$3], ws_ext_ship_cost=[$4], ws_net_profit=[$5], d_date_sk=[$6], d_date=[$7], ca_address_sk=[$8], ca_state=[$9], web_site_sk=[$10], web_company_name=[$11])
        HiveProject(ws_ship_date_sk=[$0], ws_ship_addr_sk=[$1], ws_web_site_sk=[$2], ws_order_number=[$3], ws_ext_ship_cost=[$4], ws_net_profit=[$5], d_date_sk=[$6], d_date=[$7], ca_address_sk=[$8], ca_state=[$9], web_site_sk=[$10], web_company_name=[$11])
          HiveJdbcConverter(convention=[JDBC.POSTGRES])
            JdbcJoin(condition=[=($2, $10)], joinType=[inner])
              JdbcJoin(condition=[=($1, $8)], joinType=[inner])
                JdbcJoin(condition=[=($0, $6)], joinType=[inner])
                  JdbcProject(ws_ship_date_sk=[$0], ws_ship_addr_sk=[$1], ws_web_site_sk=[$2], ws_order_number=[$3], ws_ext_ship_cost=[$4], ws_net_profit=[$5])
                    JdbcFilter(condition=[AND(IS NOT NULL($3), IS NOT NULL($0), IS NOT NULL($1), IS NOT NULL($2))])
                      JdbcProject(ws_ship_date_sk=[$2], ws_ship_addr_sk=[$11], ws_web_site_sk=[$13], ws_order_number=[$17], ws_ext_ship_cost=[$28], ws_net_profit=[$33])
                        JdbcHiveTableScan(table=[[default, web_sales]], table:alias=[ws1])
                  JdbcProject(d_date_sk=[$0], d_date=[$1])
                    JdbcFilter(condition=[AND(BETWEEN(false, CAST($1):TIMESTAMP(9), 1999-05-01 00:00:00:TIMESTAMP(9), 1999-06-30 00:00:00:TIMESTAMP(9)), IS NOT NULL($0))])
                      JdbcProject(d_date_sk=[$0], d_date=[$2])
                        JdbcHiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
                JdbcProject(ca_address_sk=[$0], ca_state=[$1])
                  JdbcFilter(condition=[AND(=($1, _UTF-16LE'TX'), IS NOT NULL($0))])
                    JdbcProject(ca_address_sk=[$0], ca_state=[$8])
                      JdbcHiveTableScan(table=[[default, customer_address]], table:alias=[customer_address])
              JdbcProject(web_site_sk=[$0], web_company_name=[$1])
                JdbcFilter(condition=[AND(=($1, _UTF-16LE'pri'), IS NOT NULL($0))])
                  JdbcProject(web_site_sk=[$0], web_company_name=[$14])
                    JdbcHiveTableScan(table=[[default, web_site]], table:alias=[web_site])
      HiveProject(ws_order_number=[$0])
        HiveJdbcConverter(convention=[JDBC.POSTGRES])
          JdbcProject(ws_order_number=[$1])
            JdbcJoin(condition=[AND(=($1, $3), <>($0, $2))], joinType=[inner])
              JdbcProject(ws_warehouse_sk=[$0], ws_order_number=[$1])
                JdbcFilter(condition=[IS NOT NULL($1)])
                  JdbcProject(ws_warehouse_sk=[$15], ws_order_number=[$17])
                    JdbcHiveTableScan(table=[[default, web_sales]], table:alias=[ws1])
              JdbcProject(ws_warehouse_sk=[$0], ws_order_number=[$1])
                JdbcFilter(condition=[IS NOT NULL($1)])
                  JdbcProject(ws_warehouse_sk=[$15], ws_order_number=[$17])
                    JdbcHiveTableScan(table=[[default, web_sales]], table:alias=[ws2])
    HiveProject(wr_order_number=[$0])
      HiveJdbcConverter(convention=[JDBC.POSTGRES])
        JdbcProject(wr_order_number=[$2])
          JdbcJoin(condition=[AND(=($1, $4), <>($0, $3))], joinType=[inner])
            JdbcJoin(condition=[=($2, $1)], joinType=[inner])
              JdbcProject(ws_warehouse_sk=[$0], ws_order_number=[$1])
                JdbcFilter(condition=[IS NOT NULL($1)])
                  JdbcProject(ws_warehouse_sk=[$15], ws_order_number=[$17])
                    JdbcHiveTableScan(table=[[default, web_sales]], table:alias=[ws1])
              JdbcProject(wr_order_number=[$0])
                JdbcFilter(condition=[IS NOT NULL($0)])
                  JdbcProject(wr_order_number=[$13])
                    JdbcHiveTableScan(table=[[default, web_returns]], table:alias=[web_returns])
            JdbcProject(ws_warehouse_sk=[$0], ws_order_number=[$1])
              JdbcFilter(condition=[IS NOT NULL($1)])
                JdbcProject(ws_warehouse_sk=[$15], ws_order_number=[$17])
                  JdbcHiveTableScan(table=[[default, web_sales]], table:alias=[ws2])

