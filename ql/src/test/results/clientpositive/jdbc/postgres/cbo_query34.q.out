PREHOOK: query: explain cbo
select c_last_name
       ,c_first_name
       ,c_salutation
       ,c_preferred_cust_flag
       ,ss_ticket_number
       ,cnt from
   (select ss_ticket_number
          ,ss_customer_sk
          ,count(*) cnt
    from store_sales,date_dim,store,household_demographics
    where store_sales.ss_sold_date_sk = date_dim.d_date_sk
    and store_sales.ss_store_sk = store.s_store_sk  
    and store_sales.ss_hdemo_sk = household_demographics.hd_demo_sk
    and (date_dim.d_dom between 1 and 3 or date_dim.d_dom between 25 and 28)
    and (household_demographics.hd_buy_potential = '>10000' or
         household_demographics.hd_buy_potential = 'unknown')
    and household_demographics.hd_vehicle_count > 0
    and (case when household_demographics.hd_vehicle_count > 0 
	then household_demographics.hd_dep_count/ household_demographics.hd_vehicle_count 
	else null 
	end)  > 1.2
    and date_dim.d_year in (2000,2000+1,2000+2)
    and store.s_county in ('Mobile County','Maverick County','Huron County','Kittitas County',
                           'Fairfield County','Jackson County','Barrow County','Pennington County')
    group by ss_ticket_number,ss_customer_sk) dn,customer
    where ss_customer_sk = c_customer_sk
      and cnt between 15 and 20
    order by c_last_name,c_first_name,c_salutation,c_preferred_cust_flag desc
PREHOOK: type: QUERY
PREHOOK: Input: default@customer
PREHOOK: Input: default@date_dim
PREHOOK: Input: default@household_demographics
PREHOOK: Input: default@store
PREHOOK: Input: default@store_sales
#### A masked pattern was here ####
POSTHOOK: query: explain cbo
select c_last_name
       ,c_first_name
       ,c_salutation
       ,c_preferred_cust_flag
       ,ss_ticket_number
       ,cnt from
   (select ss_ticket_number
          ,ss_customer_sk
          ,count(*) cnt
    from store_sales,date_dim,store,household_demographics
    where store_sales.ss_sold_date_sk = date_dim.d_date_sk
    and store_sales.ss_store_sk = store.s_store_sk  
    and store_sales.ss_hdemo_sk = household_demographics.hd_demo_sk
    and (date_dim.d_dom between 1 and 3 or date_dim.d_dom between 25 and 28)
    and (household_demographics.hd_buy_potential = '>10000' or
         household_demographics.hd_buy_potential = 'unknown')
    and household_demographics.hd_vehicle_count > 0
    and (case when household_demographics.hd_vehicle_count > 0 
	then household_demographics.hd_dep_count/ household_demographics.hd_vehicle_count 
	else null 
	end)  > 1.2
    and date_dim.d_year in (2000,2000+1,2000+2)
    and store.s_county in ('Mobile County','Maverick County','Huron County','Kittitas County',
                           'Fairfield County','Jackson County','Barrow County','Pennington County')
    group by ss_ticket_number,ss_customer_sk) dn,customer
    where ss_customer_sk = c_customer_sk
      and cnt between 15 and 20
    order by c_last_name,c_first_name,c_salutation,c_preferred_cust_flag desc
POSTHOOK: type: QUERY
POSTHOOK: Input: default@customer
POSTHOOK: Input: default@date_dim
POSTHOOK: Input: default@household_demographics
POSTHOOK: Input: default@store
POSTHOOK: Input: default@store_sales
#### A masked pattern was here ####
CBO PLAN:
HiveJdbcConverter(convention=[JDBC.POSTGRES])
  JdbcSort(sort0=[$0], sort1=[$1], sort2=[$2], sort3=[$3], dir0=[ASC], dir1=[ASC], dir2=[ASC], dir3=[DESC])
    JdbcProject(c_last_name=[$3], c_first_name=[$2], c_salutation=[$1], c_preferred_cust_flag=[$4], ss_ticket_number=[$5], cnt=[$7])
      JdbcJoin(condition=[=($6, $0)], joinType=[inner])
        JdbcProject(c_customer_sk=[$0], c_salutation=[$1], c_first_name=[$2], c_last_name=[$3], c_preferred_cust_flag=[$4])
          JdbcFilter(condition=[IS NOT NULL($0)])
            JdbcProject(c_customer_sk=[$0], c_salutation=[$7], c_first_name=[$8], c_last_name=[$9], c_preferred_cust_flag=[$10])
              JdbcHiveTableScan(table=[[default, customer]], table:alias=[customer])
        JdbcProject(ss_ticket_number=[$0], ss_customer_sk=[$1], $f2=[$2])
          JdbcFilter(condition=[BETWEEN(false, $2, 15:BIGINT, 20:BIGINT)])
            JdbcProject(ss_ticket_number=[$1], ss_customer_sk=[$0], $f2=[$2])
              JdbcAggregate(group=[{1, 4}], agg#0=[count()])
                JdbcJoin(condition=[=($2, $7)], joinType=[inner])
                  JdbcJoin(condition=[=($3, $6)], joinType=[inner])
                    JdbcJoin(condition=[=($0, $5)], joinType=[inner])
                      JdbcProject(ss_sold_date_sk=[$0], ss_customer_sk=[$1], ss_hdemo_sk=[$2], ss_store_sk=[$3], ss_ticket_number=[$4])
                        JdbcFilter(condition=[AND(IS NOT NULL($0), IS NOT NULL($3), IS NOT NULL($2), IS NOT NULL($1))])
                          JdbcProject(ss_sold_date_sk=[$0], ss_customer_sk=[$3], ss_hdemo_sk=[$5], ss_store_sk=[$7], ss_ticket_number=[$9])
                            JdbcHiveTableScan(table=[[default, store_sales]], table:alias=[store_sales])
                      JdbcProject(d_date_sk=[$0])
                        JdbcFilter(condition=[AND(OR(BETWEEN(false, $2, 1, 3), BETWEEN(false, $2, 25, 28)), OR(<=(1, $2), <=($2, 3), <=(25, $2), <=($2, 28)), IN($1, 2000, 2001, 2002), IS NOT NULL($0))])
                          JdbcProject(d_date_sk=[$0], d_year=[$6], d_dom=[$9])
                            JdbcHiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
                    JdbcProject(s_store_sk=[$0])
                      JdbcFilter(condition=[AND(IN($1, _UTF-16LE'Mobile County':VARCHAR(2147483647) CHARACTER SET "UTF-16LE", _UTF-16LE'Maverick County':VARCHAR(2147483647) CHARACTER SET "UTF-16LE", _UTF-16LE'Huron County':VARCHAR(2147483647) CHARACTER SET "UTF-16LE", _UTF-16LE'Kittitas County':VARCHAR(2147483647) CHARACTER SET "UTF-16LE", _UTF-16LE'Fairfield County':VARCHAR(2147483647) CHARACTER SET "UTF-16LE", _UTF-16LE'Jackson County':VARCHAR(2147483647) CHARACTER SET "UTF-16LE", _UTF-16LE'Barrow County':VARCHAR(2147483647) CHARACTER SET "UTF-16LE", _UTF-16LE'Pennington County':VARCHAR(2147483647) CHARACTER SET "UTF-16LE"), IS NOT NULL($0))])
                        JdbcProject(s_store_sk=[$0], s_county=[$23])
                          JdbcHiveTableScan(table=[[default, store]], table:alias=[store])
                  JdbcProject(hd_demo_sk=[$0])
                    JdbcFilter(condition=[AND(>($3, 0), IN($1, _UTF-16LE'>10000':VARCHAR(2147483647) CHARACTER SET "UTF-16LE", _UTF-16LE'unknown':VARCHAR(2147483647) CHARACTER SET "UTF-16LE"), CASE(>($3, 0), >(/(CAST($2):DOUBLE, CAST($3):DOUBLE), 1.2), false), IS NOT NULL($0))])
                      JdbcProject(hd_demo_sk=[$0], hd_buy_potential=[$2], hd_dep_count=[$3], hd_vehicle_count=[$4])
                        JdbcHiveTableScan(table=[[default, household_demographics]], table:alias=[household_demographics])

