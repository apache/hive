PREHOOK: query: explain
with ssci as (
select ss_customer_sk customer_sk
      ,ss_item_sk item_sk
from store_sales,date_dim
where ss_sold_date_sk = d_date_sk
  and d_month_seq between 1212 and 1212 + 11
group by ss_customer_sk
        ,ss_item_sk),
csci as(
 select cs_bill_customer_sk customer_sk
      ,cs_item_sk item_sk
from catalog_sales,date_dim
where cs_sold_date_sk = d_date_sk
  and d_month_seq between 1212 and 1212 + 11
group by cs_bill_customer_sk
        ,cs_item_sk)
 select  sum(case when ssci.customer_sk is not null and csci.customer_sk is null then 1 else 0 end) store_only
      ,sum(case when ssci.customer_sk is null and csci.customer_sk is not null then 1 else 0 end) catalog_only
      ,sum(case when ssci.customer_sk is not null and csci.customer_sk is not null then 1 else 0 end) store_and_catalog
from ssci full outer join csci on (ssci.customer_sk=csci.customer_sk
                               and ssci.item_sk = csci.item_sk)
limit 100
PREHOOK: type: QUERY
PREHOOK: Input: default@catalog_sales
PREHOOK: Input: default@date_dim
PREHOOK: Input: default@store_sales
#### A masked pattern was here ####
POSTHOOK: query: explain
with ssci as (
select ss_customer_sk customer_sk
      ,ss_item_sk item_sk
from store_sales,date_dim
where ss_sold_date_sk = d_date_sk
  and d_month_seq between 1212 and 1212 + 11
group by ss_customer_sk
        ,ss_item_sk),
csci as(
 select cs_bill_customer_sk customer_sk
      ,cs_item_sk item_sk
from catalog_sales,date_dim
where cs_sold_date_sk = d_date_sk
  and d_month_seq between 1212 and 1212 + 11
group by cs_bill_customer_sk
        ,cs_item_sk)
 select  sum(case when ssci.customer_sk is not null and csci.customer_sk is null then 1 else 0 end) store_only
      ,sum(case when ssci.customer_sk is null and csci.customer_sk is not null then 1 else 0 end) catalog_only
      ,sum(case when ssci.customer_sk is not null and csci.customer_sk is not null then 1 else 0 end) store_and_catalog
from ssci full outer join csci on (ssci.customer_sk=csci.customer_sk
                               and ssci.item_sk = csci.item_sk)
limit 100
POSTHOOK: type: QUERY
POSTHOOK: Input: default@catalog_sales
POSTHOOK: Input: default@date_dim
POSTHOOK: Input: default@store_sales
#### A masked pattern was here ####
STAGE DEPENDENCIES:
  Stage-0 is a root stage

STAGE PLANS:
  Stage: Stage-0
    Fetch Operator
      limit: -1
      Processor Tree:
        TableScan
          alias: store_sales
          properties:
            hive.sql.query SELECT SUM(CAST(CASE WHEN "t13"."cs_bill_customer_sk" IS NULL AND "t6"."ss_customer_sk" IS NOT NULL THEN 1 ELSE 0 END AS INTEGER)) AS "$f0", SUM(CAST(CASE WHEN "t6"."ss_customer_sk" IS NULL AND "t13"."cs_bill_customer_sk" IS NOT NULL THEN 1 ELSE 0 END AS INTEGER)) AS "$f1", SUM(CAST(CASE WHEN "t6"."ss_customer_sk" IS NOT NULL AND "t13"."cs_bill_customer_sk" IS NOT NULL THEN 1 ELSE 0 END AS INTEGER)) AS "$f2"
FROM (SELECT "t1"."ss_customer_sk", "t1"."ss_item_sk"
FROM (SELECT "ss_sold_date_sk", "ss_item_sk", "ss_customer_sk"
FROM (SELECT "ss_sold_date_sk", "ss_item_sk", "ss_customer_sk"
FROM "store_sales") AS "t"
WHERE "ss_sold_date_sk" IS NOT NULL) AS "t1"
INNER JOIN (SELECT "d_date_sk"
FROM (SELECT "d_date_sk", "d_month_seq"
FROM "date_dim") AS "t2"
WHERE "d_month_seq" BETWEEN 1212 AND 1223 AND "d_date_sk" IS NOT NULL) AS "t4" ON "t1"."ss_sold_date_sk" = "t4"."d_date_sk"
GROUP BY "t1"."ss_item_sk", "t1"."ss_customer_sk") AS "t6"
FULL JOIN (SELECT "t9"."cs_bill_customer_sk", "t9"."cs_item_sk"
FROM (SELECT "cs_sold_date_sk", "cs_bill_customer_sk", "cs_item_sk"
FROM (SELECT "cs_sold_date_sk", "cs_bill_customer_sk", "cs_item_sk"
FROM "catalog_sales") AS "t7"
WHERE "cs_sold_date_sk" IS NOT NULL) AS "t9"
INNER JOIN (SELECT "d_date_sk"
FROM (SELECT "d_date_sk", "d_month_seq"
FROM "date_dim") AS "t10"
WHERE "d_month_seq" BETWEEN 1212 AND 1223 AND "d_date_sk" IS NOT NULL) AS "t12" ON "t9"."cs_sold_date_sk" = "t12"."d_date_sk"
GROUP BY "t9"."cs_bill_customer_sk", "t9"."cs_item_sk") AS "t13" ON "t6"."ss_customer_sk" = "t13"."cs_bill_customer_sk" AND "t6"."ss_item_sk" = "t13"."cs_item_sk"
            hive.sql.query.fieldNames $f0,$f1,$f2
            hive.sql.query.fieldTypes bigint,bigint,bigint
            hive.sql.query.split false
          Select Operator
            expressions: $f0 (type: bigint), $f1 (type: bigint), $f2 (type: bigint)
            outputColumnNames: _col0, _col1, _col2
            ListSink

