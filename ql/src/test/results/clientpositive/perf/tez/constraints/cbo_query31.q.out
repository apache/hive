PREHOOK: query: explain cbo
with ss as
 (select ca_county,d_qoy, d_year,sum(ss_ext_sales_price) as store_sales
 from store_sales,date_dim,customer_address
 where ss_sold_date_sk = d_date_sk
  and ss_addr_sk=ca_address_sk
 group by ca_county,d_qoy, d_year),
 ws as
 (select ca_county,d_qoy, d_year,sum(ws_ext_sales_price) as web_sales
 from web_sales,date_dim,customer_address
 where ws_sold_date_sk = d_date_sk
  and ws_bill_addr_sk=ca_address_sk
 group by ca_county,d_qoy, d_year)
 select /* tt */
        ss1.ca_county
       ,ss1.d_year
       ,ws2.web_sales/ws1.web_sales web_q1_q2_increase
       ,ss2.store_sales/ss1.store_sales store_q1_q2_increase
       ,ws3.web_sales/ws2.web_sales web_q2_q3_increase
       ,ss3.store_sales/ss2.store_sales store_q2_q3_increase
 from
        ss ss1
       ,ss ss2
       ,ss ss3
       ,ws ws1
       ,ws ws2
       ,ws ws3
 where
    ss1.d_qoy = 1
    and ss1.d_year = 2000
    and ss1.ca_county = ss2.ca_county
    and ss2.d_qoy = 2
    and ss2.d_year = 2000
 and ss2.ca_county = ss3.ca_county
    and ss3.d_qoy = 3
    and ss3.d_year = 2000
    and ss1.ca_county = ws1.ca_county
    and ws1.d_qoy = 1
    and ws1.d_year = 2000
    and ws1.ca_county = ws2.ca_county
    and ws2.d_qoy = 2
    and ws2.d_year = 2000
    and ws1.ca_county = ws3.ca_county
    and ws3.d_qoy = 3
    and ws3.d_year =2000
    and case when ws1.web_sales > 0 then ws2.web_sales/ws1.web_sales else null end 
       > case when ss1.store_sales > 0 then ss2.store_sales/ss1.store_sales else null end
    and case when ws2.web_sales > 0 then ws3.web_sales/ws2.web_sales else null end
       > case when ss2.store_sales > 0 then ss3.store_sales/ss2.store_sales else null end
 order by ss1.d_year
PREHOOK: type: QUERY
PREHOOK: Input: default@customer_address
PREHOOK: Input: default@date_dim
PREHOOK: Input: default@store_sales
PREHOOK: Input: default@web_sales
PREHOOK: Output: hdfs://### HDFS PATH ###
POSTHOOK: query: explain cbo
with ss as
 (select ca_county,d_qoy, d_year,sum(ss_ext_sales_price) as store_sales
 from store_sales,date_dim,customer_address
 where ss_sold_date_sk = d_date_sk
  and ss_addr_sk=ca_address_sk
 group by ca_county,d_qoy, d_year),
 ws as
 (select ca_county,d_qoy, d_year,sum(ws_ext_sales_price) as web_sales
 from web_sales,date_dim,customer_address
 where ws_sold_date_sk = d_date_sk
  and ws_bill_addr_sk=ca_address_sk
 group by ca_county,d_qoy, d_year)
 select /* tt */
        ss1.ca_county
       ,ss1.d_year
       ,ws2.web_sales/ws1.web_sales web_q1_q2_increase
       ,ss2.store_sales/ss1.store_sales store_q1_q2_increase
       ,ws3.web_sales/ws2.web_sales web_q2_q3_increase
       ,ss3.store_sales/ss2.store_sales store_q2_q3_increase
 from
        ss ss1
       ,ss ss2
       ,ss ss3
       ,ws ws1
       ,ws ws2
       ,ws ws3
 where
    ss1.d_qoy = 1
    and ss1.d_year = 2000
    and ss1.ca_county = ss2.ca_county
    and ss2.d_qoy = 2
    and ss2.d_year = 2000
 and ss2.ca_county = ss3.ca_county
    and ss3.d_qoy = 3
    and ss3.d_year = 2000
    and ss1.ca_county = ws1.ca_county
    and ws1.d_qoy = 1
    and ws1.d_year = 2000
    and ws1.ca_county = ws2.ca_county
    and ws2.d_qoy = 2
    and ws2.d_year = 2000
    and ws1.ca_county = ws3.ca_county
    and ws3.d_qoy = 3
    and ws3.d_year =2000
    and case when ws1.web_sales > 0 then ws2.web_sales/ws1.web_sales else null end 
       > case when ss1.store_sales > 0 then ss2.store_sales/ss1.store_sales else null end
    and case when ws2.web_sales > 0 then ws3.web_sales/ws2.web_sales else null end
       > case when ss2.store_sales > 0 then ss3.store_sales/ss2.store_sales else null end
 order by ss1.d_year
POSTHOOK: type: QUERY
POSTHOOK: Input: default@customer_address
POSTHOOK: Input: default@date_dim
POSTHOOK: Input: default@store_sales
POSTHOOK: Input: default@web_sales
POSTHOOK: Output: hdfs://### HDFS PATH ###
CBO PLAN:
HiveProject(ca_county=[$0], d_year=[CAST(2000):INTEGER], web_q1_q2_increase=[$3], store_q1_q2_increase=[$4], web_q2_q3_increase=[/($10, $2)], store_q2_q3_increase=[$5])
  HiveJoin(condition=[AND(=($1, $9), CASE($6, CASE($7, >(/($10, $2), $5), $8), CASE($7, >(/($10, $2), null), null)))], joinType=[inner], algorithm=[none], cost=[not available])
    HiveProject($f0=[$0], $f02=[$0], $f33=[$11], /=[/($11, $8)], /11=[$1], /12=[$2], >=[$3], >14=[$12], >15=[$4])
      HiveJoin(condition=[AND(=($0, $10), CASE($5, CASE($9, >(/($11, $8), $1), $6), CASE($9, >(/($11, $8), null), null)))], joinType=[inner], algorithm=[none], cost=[not available])
        HiveJoin(condition=[=($0, $7)], joinType=[inner], algorithm=[none], cost=[not available])
          HiveProject($f0=[$0], /=[/($1, $4)], /7=[/($7, $1)], >=[$2], >9=[>(null, /($7, $1))], >10=[$5], >11=[>(null, /($1, $4))])
            HiveJoin(condition=[=($0, $6)], joinType=[inner], algorithm=[none], cost=[not available])
              HiveJoin(condition=[=($3, $0)], joinType=[inner], algorithm=[none], cost=[not available])
                HiveProject($f0=[$0], $f3=[$1], >=[>($1, 0)])
                  HiveAggregate(group=[{1}], agg#0=[sum($4)])
                    HiveJoin(condition=[=($3, $0)], joinType=[inner], algorithm=[none], cost=[not available])
                      HiveProject(ca_address_sk=[$0], ca_county=[$7])
                        HiveFilter(condition=[IS NOT NULL($7)])
                          HiveTableScan(table=[[default, customer_address]], table:alias=[customer_address])
                      HiveJoin(condition=[=($0, $3)], joinType=[inner], algorithm=[none], cost=[not available])
                        HiveProject(ss_sold_date_sk=[$0], ss_addr_sk=[$6], ss_ext_sales_price=[$15])
                          HiveFilter(condition=[AND(IS NOT NULL($0), IS NOT NULL($6))])
                            HiveTableScan(table=[[default, store_sales]], table:alias=[store_sales])
                        HiveProject(d_date_sk=[$0])
                          HiveFilter(condition=[AND(=($10, 2), =($6, 2000))])
                            HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
                HiveProject($f0=[$0], $f3=[$1], >=[>($1, 0)])
                  HiveAggregate(group=[{1}], agg#0=[sum($4)])
                    HiveJoin(condition=[=($3, $0)], joinType=[inner], algorithm=[none], cost=[not available])
                      HiveProject(ca_address_sk=[$0], ca_county=[$7])
                        HiveFilter(condition=[IS NOT NULL($7)])
                          HiveTableScan(table=[[default, customer_address]], table:alias=[customer_address])
                      HiveJoin(condition=[=($0, $3)], joinType=[inner], algorithm=[none], cost=[not available])
                        HiveProject(ss_sold_date_sk=[$0], ss_addr_sk=[$6], ss_ext_sales_price=[$15])
                          HiveFilter(condition=[AND(IS NOT NULL($0), IS NOT NULL($6))])
                            HiveTableScan(table=[[default, store_sales]], table:alias=[store_sales])
                        HiveProject(d_date_sk=[$0])
                          HiveFilter(condition=[AND(=($10, 1), =($6, 2000))])
                            HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
              HiveProject(ca_county=[$0], $f1=[$1])
                HiveAggregate(group=[{1}], agg#0=[sum($4)])
                  HiveJoin(condition=[=($3, $0)], joinType=[inner], algorithm=[none], cost=[not available])
                    HiveProject(ca_address_sk=[$0], ca_county=[$7])
                      HiveFilter(condition=[IS NOT NULL($7)])
                        HiveTableScan(table=[[default, customer_address]], table:alias=[customer_address])
                    HiveJoin(condition=[=($0, $3)], joinType=[inner], algorithm=[none], cost=[not available])
                      HiveProject(ss_sold_date_sk=[$0], ss_addr_sk=[$6], ss_ext_sales_price=[$15])
                        HiveFilter(condition=[AND(IS NOT NULL($0), IS NOT NULL($6))])
                          HiveTableScan(table=[[default, store_sales]], table:alias=[store_sales])
                      HiveProject(d_date_sk=[$0])
                        HiveFilter(condition=[AND(=($10, 3), =($6, 2000))])
                          HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
          HiveProject($f0=[$0], $f3=[$1], >=[>($1, 0)])
            HiveAggregate(group=[{1}], agg#0=[sum($4)])
              HiveJoin(condition=[=($3, $0)], joinType=[inner], algorithm=[none], cost=[not available])
                HiveProject(ca_address_sk=[$0], ca_county=[$7])
                  HiveFilter(condition=[IS NOT NULL($7)])
                    HiveTableScan(table=[[default, customer_address]], table:alias=[customer_address])
                HiveJoin(condition=[=($0, $3)], joinType=[inner], algorithm=[none], cost=[not available])
                  HiveProject(ws_sold_date_sk=[$0], ws_bill_addr_sk=[$7], ws_ext_sales_price=[$23])
                    HiveFilter(condition=[AND(IS NOT NULL($0), IS NOT NULL($7))])
                      HiveTableScan(table=[[default, web_sales]], table:alias=[web_sales])
                  HiveProject(d_date_sk=[$0])
                    HiveFilter(condition=[AND(=($10, 1), =($6, 2000))])
                      HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
        HiveProject($f0=[$0], $f3=[$1], >=[>($1, 0)])
          HiveAggregate(group=[{1}], agg#0=[sum($4)])
            HiveJoin(condition=[=($3, $0)], joinType=[inner], algorithm=[none], cost=[not available])
              HiveProject(ca_address_sk=[$0], ca_county=[$7])
                HiveFilter(condition=[IS NOT NULL($7)])
                  HiveTableScan(table=[[default, customer_address]], table:alias=[customer_address])
              HiveJoin(condition=[=($0, $3)], joinType=[inner], algorithm=[none], cost=[not available])
                HiveProject(ws_sold_date_sk=[$0], ws_bill_addr_sk=[$7], ws_ext_sales_price=[$23])
                  HiveFilter(condition=[AND(IS NOT NULL($0), IS NOT NULL($7))])
                    HiveTableScan(table=[[default, web_sales]], table:alias=[web_sales])
                HiveProject(d_date_sk=[$0])
                  HiveFilter(condition=[AND(=($10, 2), =($6, 2000))])
                    HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])
    HiveProject(ca_county=[$0], $f1=[$1])
      HiveAggregate(group=[{1}], agg#0=[sum($4)])
        HiveJoin(condition=[=($3, $0)], joinType=[inner], algorithm=[none], cost=[not available])
          HiveProject(ca_address_sk=[$0], ca_county=[$7])
            HiveFilter(condition=[IS NOT NULL($7)])
              HiveTableScan(table=[[default, customer_address]], table:alias=[customer_address])
          HiveJoin(condition=[=($0, $3)], joinType=[inner], algorithm=[none], cost=[not available])
            HiveProject(ws_sold_date_sk=[$0], ws_bill_addr_sk=[$7], ws_ext_sales_price=[$23])
              HiveFilter(condition=[AND(IS NOT NULL($0), IS NOT NULL($7))])
                HiveTableScan(table=[[default, web_sales]], table:alias=[web_sales])
            HiveProject(d_date_sk=[$0])
              HiveFilter(condition=[AND(=($10, 3), =($6, 2000))])
                HiveTableScan(table=[[default, date_dim]], table:alias=[date_dim])

