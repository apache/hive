PREHOOK: query: explain cbo with revenue_view as (
  select 
    l_suppkey as supplier_no,
    sum(l_extendedprice * (1 - l_discount)) as total_revenue
  from
    impala_tpch_lineitem
  where
    l_shipdate >= '1996-01-01'
    and l_shipdate < '1996-04-01'
  group by
    l_suppkey)
select
  s_suppkey,
  s_name,
  s_address,
  s_phone,
  total_revenue
from
  impala_tpch_supplier,
  revenue_view
where
  s_suppkey = supplier_no
  and total_revenue = (
    select
      max(total_revenue)
    from
      revenue_view
    )
order by
  s_suppkey
PREHOOK: type: QUERY
PREHOOK: Input: default@impala_tpch_lineitem
PREHOOK: Input: default@impala_tpch_supplier
PREHOOK: Output: hdfs://### HDFS PATH ###
POSTHOOK: query: explain cbo with revenue_view as (
  select 
    l_suppkey as supplier_no,
    sum(l_extendedprice * (1 - l_discount)) as total_revenue
  from
    impala_tpch_lineitem
  where
    l_shipdate >= '1996-01-01'
    and l_shipdate < '1996-04-01'
  group by
    l_suppkey)
select
  s_suppkey,
  s_name,
  s_address,
  s_phone,
  total_revenue
from
  impala_tpch_supplier,
  revenue_view
where
  s_suppkey = supplier_no
  and total_revenue = (
    select
      max(total_revenue)
    from
      revenue_view
    )
order by
  s_suppkey
POSTHOOK: type: QUERY
POSTHOOK: Input: default@impala_tpch_lineitem
POSTHOOK: Input: default@impala_tpch_supplier
POSTHOOK: Output: hdfs://### HDFS PATH ###
CBO PLAN:
ImpalaSortRel(sort0=[$0], dir0=[ASC])
  ImpalaProjectRel(s_suppkey=[$3], s_name=[$4], s_address=[$5], s_phone=[$6], total_revenue=[$1])
    ImpalaJoinRel(condition=[=($3, $0)], joinType=[inner])
      ImpalaJoinRel(condition=[=($1, $2)], joinType=[inner])
        ImpalaAggregateRel(group=[{0}], agg#0=[sum($1)], condition=[IS NOT NULL($1)])
          ImpalaProjectPassthroughRel($f0=[$2], $f1=[*($5, -(1:DECIMAL(10, 0), $6))])
            ImpalaHdfsScanRel(table=[[default, impala_tpch_lineitem]], condition=[AND(>=($10, _UTF-16LE'1996-01-01':VARCHAR(65535)), <($10, _UTF-16LE'1996-04-01':VARCHAR(65535)), IS NOT NULL($2))])
        ImpalaAggregateRel(group=[{}], agg#0=[max($1)], condition=[IS NOT NULL($0)])
          ImpalaAggregateRel(group=[{0}], agg#0=[sum($1)])
            ImpalaProjectPassthroughRel($f0=[$2], $f1=[*($5, -(1:DECIMAL(10, 0), $6))])
              ImpalaHdfsScanRel(table=[[default, impala_tpch_lineitem]], condition=[AND(>=($10, _UTF-16LE'1996-01-01':VARCHAR(65535)), <($10, _UTF-16LE'1996-04-01':VARCHAR(65535)))])
      ImpalaProjectPassthroughRel(s_suppkey=[$0], s_name=[$1], s_address=[$2], s_phone=[$4])
        ImpalaHdfsScanRel(table=[[default, impala_tpch_supplier]], condition=[IS NOT NULL($0)])

PREHOOK: query: explain with revenue_view as (
  select 
    l_suppkey as supplier_no,
    sum(l_extendedprice * (1 - l_discount)) as total_revenue
  from
    impala_tpch_lineitem
  where
    l_shipdate >= '1996-01-01'
    and l_shipdate < '1996-04-01'
  group by
    l_suppkey)
select
  s_suppkey,
  s_name,
  s_address,
  s_phone,
  total_revenue
from
  impala_tpch_supplier,
  revenue_view
where
  s_suppkey = supplier_no
  and total_revenue = (
    select
      max(total_revenue)
    from
      revenue_view
    )
order by
  s_suppkey
PREHOOK: type: QUERY
PREHOOK: Input: default@impala_tpch_lineitem
PREHOOK: Input: default@impala_tpch_supplier
PREHOOK: Output: hdfs://### HDFS PATH ###
POSTHOOK: query: explain with revenue_view as (
  select 
    l_suppkey as supplier_no,
    sum(l_extendedprice * (1 - l_discount)) as total_revenue
  from
    impala_tpch_lineitem
  where
    l_shipdate >= '1996-01-01'
    and l_shipdate < '1996-04-01'
  group by
    l_suppkey)
select
  s_suppkey,
  s_name,
  s_address,
  s_phone,
  total_revenue
from
  impala_tpch_supplier,
  revenue_view
where
  s_suppkey = supplier_no
  and total_revenue = (
    select
      max(total_revenue)
    from
      revenue_view
    )
order by
  s_suppkey
POSTHOOK: type: QUERY
POSTHOOK: Input: default@impala_tpch_lineitem
POSTHOOK: Input: default@impala_tpch_supplier
POSTHOOK: Output: hdfs://### HDFS PATH ###
STAGE DEPENDENCIES:
  Stage-1 is a root stage
  Stage-0 is a root stage

STAGE PLANS:
  Stage: Stage-1
    Impala
      Impala Plan: 
F07:PLAN FRAGMENT [UNPARTITIONED] hosts=1 instances=1
Per-Host Resources: mem-estimate=64.00KB mem-reservation=0B thread-reservation=1
  PLAN-ROOT SINK
  |  output exprs: s_suppkey, s_name, s_address, s_phone, total_revenue
  |  mem-estimate=0B mem-reservation=0B thread-reservation=0
  |
  18:MERGING-EXCHANGE [UNPARTITIONED]
     order by: s_suppkey ASC NULLS LAST
     mem-estimate=64.00KB mem-reservation=0B thread-reservation=0
     tuple-ids=10 row-size=60B cardinality=0
     in pipelines: 09(GETNEXT)

F06:PLAN FRAGMENT [RANDOM] hosts=1 instances=1
Per-Host Resources: mem-estimate=143.96MB mem-reservation=49.88MB thread-reservation=1
  DATASTREAM SINK [FRAGMENT=F07, EXCHANGE=18, UNPARTITIONED]
  |  mem-estimate=0B mem-reservation=0B thread-reservation=0
  09:SORT
  |  order by: s_suppkey ASC NULLS LAST
  |  mem-estimate=12.00MB mem-reservation=12.00MB spill-buffer=2.00MB thread-reservation=0
  |  tuple-ids=10 row-size=60B cardinality=0
  |  in pipelines: 09(GETNEXT), 11(OPEN)
  |
  00:UNION
  |  mem-estimate=0B mem-reservation=0B thread-reservation=0
  |  tuple-ids=9 row-size=60B cardinality=0
  |  in pipelines: 11(GETNEXT)
  |
  08:HASH JOIN [INNER JOIN, BROADCAST]
  |  hash predicates: default.impala_tpch_lineitem.l_suppkey = default.impala_tpch_supplier.s_suppkey
  |  fk/pk conjuncts: assumed fk/pk
  |  mem-estimate=1.94MB mem-reservation=1.94MB spill-buffer=64.00KB thread-reservation=0
  |  tuple-ids=2,6,7 row-size=84B cardinality=0
  |  in pipelines: 11(GETNEXT), 07(OPEN)
  |
  |--17:EXCHANGE [BROADCAST]
  |     mem-estimate=48.00KB mem-reservation=0B thread-reservation=0
  |     tuple-ids=7 row-size=44B cardinality=0
  |     in pipelines: 07(GETNEXT)
  |
  06:HASH JOIN [INNER JOIN, BROADCAST]
  |  hash predicates: _impala_builtins.sum(_impala_builtins.multiply(default.impala_tpch_lineitem.l_extendedprice, _impala_builtins.subtract(1, default.impala_tpch_lineitem.l_discount))) = _impala_builtins.max(_impala_builtins.sum(_impala_builtins.multiply(default.impala_tpch_lineitem_0.l_extendedprice, _impala_builtins.subtract(1, default.impala_tpch_lineitem_0.l_discount))))
  |  fk/pk conjuncts: assumed fk/pk
  |  mem-estimate=1.94MB mem-reservation=1.94MB spill-buffer=64.00KB thread-reservation=0
  |  tuple-ids=2,6 row-size=40B cardinality=0
  |  in pipelines: 11(GETNEXT), 15(OPEN)
  |
  |--16:EXCHANGE [BROADCAST]
  |     mem-estimate=16.00KB mem-reservation=0B thread-reservation=0
  |     tuple-ids=6 row-size=16B cardinality=1
  |     in pipelines: 15(GETNEXT)
  |
  11:AGGREGATE [FINALIZE]
  |  output: _impala_builtins.sum:merge(_impala_builtins.multiply(default.impala_tpch_lineitem.l_extendedprice, _impala_builtins.subtract(1, default.impala_tpch_lineitem.l_discount)))
  |  group by: default.impala_tpch_lineitem.l_suppkey
  |  having: _impala_builtins.sum(_impala_builtins.multiply(default.impala_tpch_lineitem.l_extendedprice, _impala_builtins.subtract(1, default.impala_tpch_lineitem.l_discount))) IS NOT NULL
  |  mem-estimate=128.00MB mem-reservation=34.00MB spill-buffer=2.00MB thread-reservation=0
  |  tuple-ids=2 row-size=24B cardinality=0
  |  in pipelines: 11(GETNEXT), 01(OPEN)
  |
  10:EXCHANGE [HASH(default.impala_tpch_lineitem.l_suppkey)]
     mem-estimate=28.00KB mem-reservation=0B thread-reservation=0
     tuple-ids=2 row-size=24B cardinality=0
     in pipelines: 01(GETNEXT)

F00:PLAN FRAGMENT [RANDOM] hosts=1 instances=1
Per-Host Resources: mem-estimate=128.00MB mem-reservation=34.00MB thread-reservation=1
  DATASTREAM SINK [FRAGMENT=F06, EXCHANGE=10, HASH(default.impala_tpch_lineitem.l_suppkey)]
  |  mem-estimate=0B mem-reservation=0B thread-reservation=0
  02:AGGREGATE [STREAMING]
  |  output: sum(_impala_builtins.multiply(default.impala_tpch_lineitem.l_extendedprice, _impala_builtins.subtract(CAST(1 AS DECIMAL(10,0)), default.impala_tpch_lineitem.l_discount)))
  |  group by: default.impala_tpch_lineitem.l_suppkey
  |  mem-estimate=128.00MB mem-reservation=34.00MB spill-buffer=2.00MB thread-reservation=0
  |  tuple-ids=2 row-size=24B cardinality=0
  |  in pipelines: 01(GETNEXT)
  |
  01:SCAN HDFS [default.impala_tpch_lineitem, RANDOM]
     HDFS partitions=1/1 files=0 size=0B
     predicates: default.impala_tpch_lineitem.l_suppkey IS NOT NULL, default.impala_tpch_lineitem.l_shipdate < '1996-04-01', default.impala_tpch_lineitem.l_shipdate >= '1996-01-01'
     stored statistics:
       table: rows=0 size=0B
       columns: unavailable
     extrapolated-rows=disabled max-scan-range-rows=0
     parquet statistics predicates: default.impala_tpch_lineitem.l_shipdate < '1996-04-01', default.impala_tpch_lineitem.l_shipdate >= '1996-01-01'
     mem-estimate=0B mem-reservation=0B thread-reservation=0
     tuple-ids=0 row-size=36B cardinality=0
     in pipelines: 01(GETNEXT)

F04:PLAN FRAGMENT [UNPARTITIONED] hosts=1 instances=1
Per-Host Resources: mem-estimate=10.02MB mem-reservation=0B thread-reservation=1
  DATASTREAM SINK [FRAGMENT=F06, EXCHANGE=16, BROADCAST]
  |  mem-estimate=0B mem-reservation=0B thread-reservation=0
  15:AGGREGATE [FINALIZE]
  |  output: _impala_builtins.max:merge(_impala_builtins.sum(_impala_builtins.multiply(default.impala_tpch_lineitem_0.l_extendedprice, _impala_builtins.subtract(1, default.impala_tpch_lineitem_0.l_discount))))
  |  having: _impala_builtins.max(_impala_builtins.sum(_impala_builtins.multiply(default.impala_tpch_lineitem_0.l_extendedprice, _impala_builtins.subtract(1, default.impala_tpch_lineitem_0.l_discount)))) IS NOT NULL
  |  mem-estimate=10.00MB mem-reservation=0B spill-buffer=2.00MB thread-reservation=0
  |  tuple-ids=6 row-size=16B cardinality=1
  |  in pipelines: 15(GETNEXT), 05(OPEN)
  |
  14:EXCHANGE [UNPARTITIONED]
     mem-estimate=16.00KB mem-reservation=0B thread-reservation=0
     tuple-ids=6 row-size=16B cardinality=1
     in pipelines: 05(GETNEXT)

F03:PLAN FRAGMENT [HASH(default.impala_tpch_lineitem_0.l_suppkey)] hosts=1 instances=1
Per-Host Resources: mem-estimate=138.00MB mem-reservation=34.00MB thread-reservation=1
  DATASTREAM SINK [FRAGMENT=F04, EXCHANGE=14, UNPARTITIONED]
  |  mem-estimate=0B mem-reservation=0B thread-reservation=0
  05:AGGREGATE
  |  output: max(_impala_builtins.sum(_impala_builtins.multiply(default.impala_tpch_lineitem_0.l_extendedprice, _impala_builtins.subtract(1, default.impala_tpch_lineitem_0.l_discount))))
  |  mem-estimate=10.00MB mem-reservation=0B spill-buffer=2.00MB thread-reservation=0
  |  tuple-ids=6 row-size=16B cardinality=1
  |  in pipelines: 05(GETNEXT), 13(OPEN)
  |
  13:AGGREGATE [FINALIZE]
  |  output: _impala_builtins.sum:merge(_impala_builtins.multiply(default.impala_tpch_lineitem_0.l_extendedprice, _impala_builtins.subtract(1, default.impala_tpch_lineitem_0.l_discount)))
  |  group by: default.impala_tpch_lineitem_0.l_suppkey
  |  mem-estimate=128.00MB mem-reservation=34.00MB spill-buffer=2.00MB thread-reservation=0
  |  tuple-ids=5 row-size=24B cardinality=0
  |  in pipelines: 13(GETNEXT), 03(OPEN)
  |
  12:EXCHANGE [HASH(default.impala_tpch_lineitem_0.l_suppkey)]
     mem-estimate=28.00KB mem-reservation=0B thread-reservation=0
     tuple-ids=5 row-size=24B cardinality=0
     in pipelines: 03(GETNEXT)

F02:PLAN FRAGMENT [RANDOM] hosts=1 instances=1
Per-Host Resources: mem-estimate=128.00MB mem-reservation=34.00MB thread-reservation=1
  DATASTREAM SINK [FRAGMENT=F03, EXCHANGE=12, HASH(default.impala_tpch_lineitem_0.l_suppkey)]
  |  mem-estimate=0B mem-reservation=0B thread-reservation=0
  04:AGGREGATE [STREAMING]
  |  output: sum(_impala_builtins.multiply(default.impala_tpch_lineitem_0.l_extendedprice, _impala_builtins.subtract(CAST(1 AS DECIMAL(10,0)), default.impala_tpch_lineitem_0.l_discount)))
  |  group by: default.impala_tpch_lineitem_0.l_suppkey
  |  mem-estimate=128.00MB mem-reservation=34.00MB spill-buffer=2.00MB thread-reservation=0
  |  tuple-ids=5 row-size=24B cardinality=0
  |  in pipelines: 03(GETNEXT)
  |
  03:SCAN HDFS [default.impala_tpch_lineitem, RANDOM]
     HDFS partitions=1/1 files=0 size=0B
     predicates: default.impala_tpch_lineitem_0.l_shipdate < '1996-04-01', default.impala_tpch_lineitem_0.l_shipdate >= '1996-01-01'
     stored statistics:
       table: rows=0 size=0B
       columns: unavailable
     extrapolated-rows=disabled max-scan-range-rows=0
     parquet statistics predicates: default.impala_tpch_lineitem_0.l_shipdate < '1996-04-01', default.impala_tpch_lineitem_0.l_shipdate >= '1996-01-01'
     mem-estimate=0B mem-reservation=0B thread-reservation=0
     tuple-ids=3 row-size=36B cardinality=0
     in pipelines: 03(GETNEXT)

F05:PLAN FRAGMENT [RANDOM] hosts=1 instances=1
Per-Host Resources: mem-estimate=0B mem-reservation=0B thread-reservation=1
  DATASTREAM SINK [FRAGMENT=F06, EXCHANGE=17, BROADCAST]
  |  mem-estimate=0B mem-reservation=0B thread-reservation=0
  07:SCAN HDFS [default.impala_tpch_supplier, RANDOM]
     HDFS partitions=1/1 files=0 size=0B
     predicates: default.impala_tpch_supplier.s_suppkey IS NOT NULL
     stored statistics:
       table: rows=0 size=0B
       columns: unavailable
     extrapolated-rows=disabled max-scan-range-rows=0
     mem-estimate=0B mem-reservation=0B thread-reservation=0
     tuple-ids=7 row-size=44B cardinality=0
     in pipelines: 07(GETNEXT)


  Stage: Stage-0
    Fetch Operator
      limit: -1
      Processor Tree:
        ListSink

