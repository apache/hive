HMS CALL get_table_req FOR impala_tpcds_web_sales
HMS CALL get_table_req FOR impala_tpcds_customer_address
HMS CALL get_table_req FOR impala_tpcds_item
HMS CALL get_foreign_keys FOR impala_tpcds_web_sales
HMS CALL get_foreign_keys FOR impala_tpcds_customer_address
HMS CALL get_foreign_keys FOR impala_tpcds_item
PREHOOK: query: explain cbo physical select  ca_zip, ca_county, sum(ws_sales_price)
 from impala_tpcds_web_sales, impala_tpcds_customer_address, impala_tpcds_item
 where ws_item_sk <> i_item_sk
      and ( substr(ca_zip,1,5) in ('85669', '86197','88274','83405','86475', '85392', '85460', '80348', '81792')
            or
            i_item_id in (select i_item_id
                             from impala_tpcds_item
                             where i_item_sk in (2, 3, 5, 7, 11, 13, 17, 19, 23, 29)
                             )
          )
 group by ca_zip, ca_county
PREHOOK: type: QUERY
PREHOOK: Input: default@impala_tpcds_customer_address
PREHOOK: Input: default@impala_tpcds_item
PREHOOK: Input: default@impala_tpcds_web_sales
PREHOOK: Output: streaming
POSTHOOK: query: explain cbo physical select  ca_zip, ca_county, sum(ws_sales_price)
 from impala_tpcds_web_sales, impala_tpcds_customer_address, impala_tpcds_item
 where ws_item_sk <> i_item_sk
      and ( substr(ca_zip,1,5) in ('85669', '86197','88274','83405','86475', '85392', '85460', '80348', '81792')
            or
            i_item_id in (select i_item_id
                             from impala_tpcds_item
                             where i_item_sk in (2, 3, 5, 7, 11, 13, 17, 19, 23, 29)
                             )
          )
 group by ca_zip, ca_county
POSTHOOK: type: QUERY
POSTHOOK: Input: default@impala_tpcds_customer_address
POSTHOOK: Input: default@impala_tpcds_item
POSTHOOK: Input: default@impala_tpcds_web_sales
CBO PLAN:
ImpalaProjectPassthroughRel(ca_zip=[$1], ca_county=[$0], $f2=[$2])
  ImpalaAggregateRel(group=[{2, 3}], agg#0=[sum($1)])
    ImpalaProjectRel(ws_item_sk=[$4], ws_sales_price=[$5], ca_county=[$6], ca_zip=[$7], i_item_sk=[$0], i_item_id=[$1], c=[$8], i_item_id0=[$2], literalTrue=[$3], condition=[OR(AND(<>($6, 0), IS NOT NULL($8)), IN(SUBSTRING($3, 1:BIGINT, 5:BIGINT), _UTF-16LE'85669':VARCHAR(2147483647) CHARACTER SET "UTF-16LE", _UTF-16LE'86197':VARCHAR(2147483647) CHARACTER SET "UTF-16LE", _UTF-16LE'88274':VARCHAR(2147483647) CHARACTER SET "UTF-16LE", _UTF-16LE'83405':VARCHAR(2147483647) CHARACTER SET "UTF-16LE", _UTF-16LE'86475':VARCHAR(2147483647) CHARACTER SET "UTF-16LE", _UTF-16LE'85392':VARCHAR(2147483647) CHARACTER SET "UTF-16LE", _UTF-16LE'85460':VARCHAR(2147483647) CHARACTER SET "UTF-16LE", _UTF-16LE'80348':VARCHAR(2147483647) CHARACTER SET "UTF-16LE", _UTF-16LE'81792':VARCHAR(2147483647) CHARACTER SET "UTF-16LE"))])
      ImpalaJoinRel(condition=[true], joinType=[inner])
        ImpalaJoinRel(condition=[<>($4, $0)], joinType=[inner])
          ImpalaJoinRel(condition=[=($1, $2)], joinType=[left])
            ImpalaProjectPassthroughRel(i_item_sk=[$0], i_item_id=[$1])
              ImpalaHdfsScanRel(table=[[default, impala_tpcds_item]])
            ImpalaProjectPassthroughRel(i_item_id=[$0], literalTrue=[true])
              ImpalaAggregateRel(group=[{1}])
                ImpalaHdfsScanRel(table=[[default, impala_tpcds_item]], condition=[AND(IN($0, 2:BIGINT, 3:BIGINT, 5:BIGINT, 7:BIGINT, 11:BIGINT, 13:BIGINT, 17:BIGINT, 19:BIGINT, 23:BIGINT, 29:BIGINT), IS NOT NULL($1))])
          ImpalaProjectPassthroughRel(ws_item_sk=[$3], ws_sales_price=[$21])
            ImpalaHdfsScanRel(table=[[default, impala_tpcds_web_sales]])
        ImpalaJoinRel(condition=[true], joinType=[inner])
          ImpalaProjectPassthroughRel(ca_county=[$7], ca_zip=[$9])
            ImpalaHdfsScanRel(table=[[default, impala_tpcds_customer_address]])
          ImpalaAggregateRel(group=[{}], c=[COUNT()])
            ImpalaHdfsScanRel(table=[[default, impala_tpcds_item]], condition=[IN($0, 2:BIGINT, 3:BIGINT, 5:BIGINT, 7:BIGINT, 11:BIGINT, 13:BIGINT, 17:BIGINT, 19:BIGINT, 23:BIGINT, 29:BIGINT)])

HMS CALL get_table_req FOR impala_tpcds_web_sales
HMS CALL get_table_req FOR impala_tpcds_customer_address
HMS CALL get_table_req FOR impala_tpcds_item
HMS CALL get_foreign_keys FOR impala_tpcds_web_sales
HMS CALL get_foreign_keys FOR impala_tpcds_customer_address
HMS CALL get_foreign_keys FOR impala_tpcds_item
PREHOOK: query: explain select  ca_zip, ca_county, sum(ws_sales_price)
 from impala_tpcds_web_sales, impala_tpcds_customer_address, impala_tpcds_item
 where ws_item_sk <> i_item_sk
      and ( substr(ca_zip,1,5) in ('85669', '86197','88274','83405','86475', '85392', '85460', '80348', '81792')
            or
            i_item_id in (select i_item_id
                             from impala_tpcds_item
                             where i_item_sk in (2, 3, 5, 7, 11, 13, 17, 19, 23, 29)
                             )
          )
 group by ca_zip, ca_county
PREHOOK: type: QUERY
PREHOOK: Input: default@impala_tpcds_customer_address
PREHOOK: Input: default@impala_tpcds_item
PREHOOK: Input: default@impala_tpcds_web_sales
PREHOOK: Output: streaming
POSTHOOK: query: explain select  ca_zip, ca_county, sum(ws_sales_price)
 from impala_tpcds_web_sales, impala_tpcds_customer_address, impala_tpcds_item
 where ws_item_sk <> i_item_sk
      and ( substr(ca_zip,1,5) in ('85669', '86197','88274','83405','86475', '85392', '85460', '80348', '81792')
            or
            i_item_id in (select i_item_id
                             from impala_tpcds_item
                             where i_item_sk in (2, 3, 5, 7, 11, 13, 17, 19, 23, 29)
                             )
          )
 group by ca_zip, ca_county
POSTHOOK: type: QUERY
POSTHOOK: Input: default@impala_tpcds_customer_address
POSTHOOK: Input: default@impala_tpcds_item
POSTHOOK: Input: default@impala_tpcds_web_sales
STAGE DEPENDENCIES:
  Stage-1 is a root stage
  Stage-0 is a root stage

STAGE PLANS:
  Stage: Stage-1
    Impala
      Impala Plan: 
F09:PLAN FRAGMENT [UNPARTITIONED] hosts=1 instances=1
Per-Host Resources: mem-estimate=44.00KB mem-reservation=0B thread-reservation=1
  PLAN-ROOT SINK
  |  output exprs: default.impala_tpcds_customer_address.ca_zip, default.impala_tpcds_customer_address.ca_county, _impala_builtins.sum(default.impala_tpcds_web_sales.ws_sales_price)
  |  mem-estimate=0B mem-reservation=0B thread-reservation=0
  |
  24:EXCHANGE [UNPARTITIONED]
     mem-estimate=44.00KB mem-reservation=0B thread-reservation=0
     tuple-ids=13 row-size=40B cardinality=0
     in pipelines: 23(GETNEXT)

F08:PLAN FRAGMENT [HASH(default.impala_tpcds_customer_address.ca_county,default.impala_tpcds_customer_address.ca_zip)] hosts=1 instances=1
Per-Host Resources: mem-estimate=128.04MB mem-reservation=34.00MB thread-reservation=1
  DATASTREAM SINK [FRAGMENT=F09, EXCHANGE=24, UNPARTITIONED]
  |  mem-estimate=0B mem-reservation=0B thread-reservation=0
  23:AGGREGATE [FINALIZE]
  |  output: _impala_builtins.sum:merge(default.impala_tpcds_web_sales.ws_sales_price)
  |  group by: default.impala_tpcds_customer_address.ca_county, default.impala_tpcds_customer_address.ca_zip
  |  mem-estimate=128.00MB mem-reservation=34.00MB spill-buffer=2.00MB thread-reservation=0
  |  tuple-ids=13 row-size=40B cardinality=0
  |  in pipelines: 23(GETNEXT), 01(OPEN)
  |
  22:EXCHANGE [HASH(default.impala_tpcds_customer_address.ca_county,default.impala_tpcds_customer_address.ca_zip)]
     mem-estimate=44.00KB mem-reservation=0B thread-reservation=0
     tuple-ids=13 row-size=40B cardinality=0
     in pipelines: 01(GETNEXT)

F07:PLAN FRAGMENT [RANDOM] hosts=1 instances=1
Per-Host Resources: mem-estimate=130.01MB mem-reservation=35.94MB thread-reservation=1
  DATASTREAM SINK [FRAGMENT=F08, EXCHANGE=22, HASH(default.impala_tpcds_customer_address.ca_county,default.impala_tpcds_customer_address.ca_zip)]
  |  mem-estimate=0B mem-reservation=0B thread-reservation=0
  13:AGGREGATE [STREAMING]
  |  output: sum(default.impala_tpcds_web_sales.ws_sales_price)
  |  group by: default.impala_tpcds_customer_address.ca_county, default.impala_tpcds_customer_address.ca_zip
  |  mem-estimate=128.00MB mem-reservation=34.00MB spill-buffer=2.00MB thread-reservation=0
  |  tuple-ids=13 row-size=40B cardinality=0
  |  in pipelines: 01(GETNEXT)
  |
  12:SELECT
  |  predicates: _impala_builtins.count(*) != CAST(0 AS BIGINT) AND _impala_builtins.if(TupleIsNull(4), NULL, TRUE) IS NOT NULL OR substring(default.impala_tpcds_customer_address.ca_zip, CAST(1 AS BIGINT), CAST(5 AS BIGINT)) IN ('85669', '86197', '88274', '83405', '86475', '85392', '85460', '80348', '81792')
  |  mem-estimate=0B mem-reservation=0B thread-reservation=0
  |  tuple-ids=12 row-size=77B cardinality=0
  |  in pipelines: 01(GETNEXT)
  |
  00:UNION
  |  mem-estimate=0B mem-reservation=0B thread-reservation=0
  |  tuple-ids=12 row-size=77B cardinality=0
  |  in pipelines: 01(GETNEXT)
  |
  11:NESTED LOOP JOIN [CROSS JOIN, BROADCAST]
  |  mem-estimate=0B mem-reservation=0B thread-reservation=0
  |  tuple-ids=0,4N,5,11,7 row-size=76B cardinality=0
  |  in pipelines: 01(GETNEXT), 19(OPEN)
  |
  |--21:EXCHANGE [BROADCAST]
  |     mem-estimate=40.00KB mem-reservation=0B thread-reservation=0
  |     tuple-ids=11,7 row-size=32B cardinality=0
  |     in pipelines: 19(GETNEXT)
  |
  06:NESTED LOOP JOIN [INNER JOIN, BROADCAST]
  |  join predicates: default.impala_tpcds_web_sales.ws_item_sk != default.impala_tpcds_item.i_item_sk
  |  mem-estimate=0B mem-reservation=0B thread-reservation=0
  |  tuple-ids=0,4N,5 row-size=44B cardinality=0
  |  in pipelines: 01(GETNEXT), 05(OPEN)
  |
  |--17:EXCHANGE [BROADCAST]
  |     mem-estimate=16.00KB mem-reservation=0B thread-reservation=0
  |     tuple-ids=5 row-size=12B cardinality=0
  |     in pipelines: 05(GETNEXT)
  |
  04:HASH JOIN [LEFT OUTER JOIN, BROADCAST]
  |  hash predicates: default.impala_tpcds_item.i_item_id = default.impala_tpcds_item_0.i_item_id
  |  fk/pk conjuncts: assumed fk/pk
  |  mem-estimate=1.94MB mem-reservation=1.94MB spill-buffer=64.00KB thread-reservation=0
  |  tuple-ids=0,4N row-size=32B cardinality=0
  |  in pipelines: 01(GETNEXT), 15(OPEN)
  |
  |--16:EXCHANGE [BROADCAST]
  |     mem-estimate=16.00KB mem-reservation=0B thread-reservation=0
  |     tuple-ids=4 row-size=12B cardinality=0
  |     in pipelines: 15(GETNEXT)
  |
  01:SCAN HDFS [default.impala_tpcds_item, RANDOM]
     HDFS partitions=1/1 files=0 size=0B
     stored statistics:
       table: rows=unavailable size=unavailable
       columns: unavailable
     extrapolated-rows=disabled max-scan-range-rows=0
     mem-estimate=0B mem-reservation=0B thread-reservation=0
     tuple-ids=0 row-size=20B cardinality=0
     in pipelines: 01(GETNEXT)

F02:PLAN FRAGMENT [HASH(default.impala_tpcds_item_0.i_item_id)] hosts=1 instances=1
Per-Host Resources: mem-estimate=128.02MB mem-reservation=34.00MB thread-reservation=1
  DATASTREAM SINK [FRAGMENT=F07, EXCHANGE=16, BROADCAST]
  |  mem-estimate=0B mem-reservation=0B thread-reservation=0
  15:AGGREGATE [FINALIZE]
  |  group by: default.impala_tpcds_item_0.i_item_id
  |  mem-estimate=128.00MB mem-reservation=34.00MB spill-buffer=2.00MB thread-reservation=0
  |  tuple-ids=4 row-size=12B cardinality=0
  |  in pipelines: 15(GETNEXT), 02(OPEN)
  |
  14:EXCHANGE [HASH(default.impala_tpcds_item_0.i_item_id)]
     mem-estimate=16.00KB mem-reservation=0B thread-reservation=0
     tuple-ids=4 row-size=12B cardinality=0
     in pipelines: 02(GETNEXT)

F01:PLAN FRAGMENT [RANDOM] hosts=1 instances=1
Per-Host Resources: mem-estimate=128.00MB mem-reservation=34.00MB thread-reservation=1
  DATASTREAM SINK [FRAGMENT=F02, EXCHANGE=14, HASH(default.impala_tpcds_item_0.i_item_id)]
  |  mem-estimate=0B mem-reservation=0B thread-reservation=0
  03:AGGREGATE [STREAMING]
  |  group by: default.impala_tpcds_item_0.i_item_id
  |  mem-estimate=128.00MB mem-reservation=34.00MB spill-buffer=2.00MB thread-reservation=0
  |  tuple-ids=4 row-size=12B cardinality=0
  |  in pipelines: 02(GETNEXT)
  |
  02:SCAN HDFS [default.impala_tpcds_item, RANDOM]
     HDFS partitions=1/1 files=0 size=0B
     predicates: default.impala_tpcds_item_0.i_item_id IS NOT NULL, default.impala_tpcds_item_0.i_item_sk IN (CAST(2 AS BIGINT), CAST(3 AS BIGINT), CAST(5 AS BIGINT), CAST(7 AS BIGINT), CAST(11 AS BIGINT), CAST(13 AS BIGINT), CAST(17 AS BIGINT), CAST(19 AS BIGINT), CAST(23 AS BIGINT), CAST(29 AS BIGINT))
     stored statistics:
       table: rows=unavailable size=unavailable
       columns: unavailable
     extrapolated-rows=disabled max-scan-range-rows=0
     parquet statistics predicates: default.impala_tpcds_item_0.i_item_sk IN (CAST(2 AS BIGINT), CAST(3 AS BIGINT), CAST(5 AS BIGINT), CAST(7 AS BIGINT), CAST(11 AS BIGINT), CAST(13 AS BIGINT), CAST(17 AS BIGINT), CAST(19 AS BIGINT), CAST(23 AS BIGINT), CAST(29 AS BIGINT))
     mem-estimate=0B mem-reservation=0B thread-reservation=0
     tuple-ids=2 row-size=20B cardinality=0
     in pipelines: 02(GETNEXT)

F03:PLAN FRAGMENT [RANDOM] hosts=1 instances=1
Per-Host Resources: mem-estimate=0B mem-reservation=0B thread-reservation=1
  DATASTREAM SINK [FRAGMENT=F07, EXCHANGE=17, BROADCAST]
  |  mem-estimate=0B mem-reservation=0B thread-reservation=0
  05:SCAN HDFS [default.impala_tpcds_web_sales, RANDOM]
     HDFS partitions=1/1 files=0 size=0B
     stored statistics:
       table: rows=unavailable size=unavailable
       columns: unavailable
     extrapolated-rows=disabled max-scan-range-rows=0
     mem-estimate=0B mem-reservation=0B thread-reservation=0
     tuple-ids=5 row-size=12B cardinality=0
     in pipelines: 05(GETNEXT)

F05:PLAN FRAGMENT [UNPARTITIONED] hosts=1 instances=1
Per-Host Resources: mem-estimate=10.04MB mem-reservation=0B thread-reservation=1
  DATASTREAM SINK [FRAGMENT=F07, EXCHANGE=21, BROADCAST]
  |  mem-estimate=0B mem-reservation=0B thread-reservation=0
  10:NESTED LOOP JOIN [CROSS JOIN, BROADCAST]
  |  mem-estimate=0B mem-reservation=0B thread-reservation=0
  |  tuple-ids=11,7 row-size=32B cardinality=0
  |  in pipelines: 19(GETNEXT), 07(OPEN)
  |
  |--20:EXCHANGE [UNPARTITIONED]
  |     mem-estimate=28.00KB mem-reservation=0B thread-reservation=0
  |     tuple-ids=7 row-size=24B cardinality=0
  |     in pipelines: 07(GETNEXT)
  |
  19:AGGREGATE [FINALIZE]
  |  output: _impala_builtins.count:merge(*)
  |  mem-estimate=10.00MB mem-reservation=0B spill-buffer=2.00MB thread-reservation=0
  |  tuple-ids=11 row-size=8B cardinality=1
  |  in pipelines: 19(GETNEXT), 09(OPEN)
  |
  18:EXCHANGE [UNPARTITIONED]
     mem-estimate=16.00KB mem-reservation=0B thread-reservation=0
     tuple-ids=11 row-size=8B cardinality=1
     in pipelines: 09(GETNEXT)

F04:PLAN FRAGMENT [RANDOM] hosts=1 instances=1
Per-Host Resources: mem-estimate=10.00MB mem-reservation=0B thread-reservation=1
  DATASTREAM SINK [FRAGMENT=F05, EXCHANGE=18, UNPARTITIONED]
  |  mem-estimate=0B mem-reservation=0B thread-reservation=0
  09:AGGREGATE
  |  output: count(*)
  |  mem-estimate=10.00MB mem-reservation=0B spill-buffer=2.00MB thread-reservation=0
  |  tuple-ids=11 row-size=8B cardinality=1
  |  in pipelines: 09(GETNEXT), 08(OPEN)
  |
  08:SCAN HDFS [default.impala_tpcds_item, RANDOM]
     HDFS partitions=1/1 files=0 size=0B
     predicates: default.impala_tpcds_item_1.i_item_sk IN (CAST(2 AS BIGINT), CAST(3 AS BIGINT), CAST(5 AS BIGINT), CAST(7 AS BIGINT), CAST(11 AS BIGINT), CAST(13 AS BIGINT), CAST(17 AS BIGINT), CAST(19 AS BIGINT), CAST(23 AS BIGINT), CAST(29 AS BIGINT))
     stored statistics:
       table: rows=unavailable size=unavailable
       columns: unavailable
     extrapolated-rows=disabled max-scan-range-rows=0
     parquet statistics predicates: default.impala_tpcds_item_1.i_item_sk IN (CAST(2 AS BIGINT), CAST(3 AS BIGINT), CAST(5 AS BIGINT), CAST(7 AS BIGINT), CAST(11 AS BIGINT), CAST(13 AS BIGINT), CAST(17 AS BIGINT), CAST(19 AS BIGINT), CAST(23 AS BIGINT), CAST(29 AS BIGINT))
     mem-estimate=0B mem-reservation=0B thread-reservation=0
     tuple-ids=9 row-size=20B cardinality=0
     in pipelines: 08(GETNEXT)

F06:PLAN FRAGMENT [RANDOM] hosts=1 instances=1
Per-Host Resources: mem-estimate=0B mem-reservation=0B thread-reservation=1
  DATASTREAM SINK [FRAGMENT=F05, EXCHANGE=20, UNPARTITIONED]
  |  mem-estimate=0B mem-reservation=0B thread-reservation=0
  07:SCAN HDFS [default.impala_tpcds_customer_address, RANDOM]
     HDFS partitions=1/1 files=0 size=0B
     stored statistics:
       table: rows=unavailable size=unavailable
       columns: unavailable
     extrapolated-rows=disabled max-scan-range-rows=0
     mem-estimate=0B mem-reservation=0B thread-reservation=0
     tuple-ids=7 row-size=24B cardinality=0
     in pipelines: 07(GETNEXT)


  Stage: Stage-0
    Fetch Operator
      limit: -1
      Processor Tree:
        ListSink

