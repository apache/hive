PREHOOK: query: explain cbo select
  sum(l_extendedprice) / 7.0 as avg_yearly
from
  impala_tpch_lineitem,
  impala_tpch_part
where
  p_partkey = l_partkey
  and p_brand = 'Brand#23'
  and p_container = 'MED BOX'
  and l_quantity < (
    select
      0.2 * avg(l_quantity)
    from
      impala_tpch_lineitem
    where
      l_partkey = p_partkey
  )
PREHOOK: type: QUERY
PREHOOK: Input: default@impala_tpch_lineitem
PREHOOK: Input: default@impala_tpch_part
PREHOOK: Output: streaming
POSTHOOK: query: explain cbo select
  sum(l_extendedprice) / 7.0 as avg_yearly
from
  impala_tpch_lineitem,
  impala_tpch_part
where
  p_partkey = l_partkey
  and p_brand = 'Brand#23'
  and p_container = 'MED BOX'
  and l_quantity < (
    select
      0.2 * avg(l_quantity)
    from
      impala_tpch_lineitem
    where
      l_partkey = p_partkey
  )
POSTHOOK: type: QUERY
POSTHOOK: Input: default@impala_tpch_lineitem
POSTHOOK: Input: default@impala_tpch_part
CBO PLAN:
ImpalaProjectPassthroughRel(avg_yearly=[/($0, 7:DECIMAL(1, 0))])
  ImpalaAggregateRel(group=[{}], agg#0=[sum($2)])
    ImpalaJoinRel(condition=[AND(=($4, $3), <($1, $5))], joinType=[inner])
      ImpalaJoinRel(condition=[=($3, $0)], joinType=[inner])
        ImpalaProjectPassthroughRel(l_partkey=[$1], l_quantity=[$4], l_extendedprice=[$5])
          ImpalaHdfsScanRel(table=[[default, impala_tpch_lineitem]], condition=[AND(IS NOT NULL($4), IS NOT NULL($1))])
        ImpalaProjectPassthroughRel(p_partkey=[$0])
          ImpalaHdfsScanRel(table=[[default, impala_tpch_part]], condition=[AND(=($3, _UTF-16LE'Brand#23'), =($6, _UTF-16LE'MED BOX'), IS NOT NULL($0))])
      ImpalaProjectPassthroughRel(l_partkey=[$0], *=[*(0.2:DECIMAL(1, 1), CAST(/($1, CAST($2):DECIMAL(19, 0))):DECIMAL(16, 6))])
        ImpalaAggregateRel(group=[{1}], agg#0=[sum($4)], agg#1=[count($4)], condition=[IS NOT NULL(CAST(/($1, CAST($2):DECIMAL(19, 0))):DECIMAL(16, 6))])
          ImpalaHdfsScanRel(table=[[default, impala_tpch_lineitem]], condition=[IS NOT NULL($1)])

PREHOOK: query: explain select
  sum(l_extendedprice) / 7.0 as avg_yearly
from
  impala_tpch_lineitem,
  impala_tpch_part
where
  p_partkey = l_partkey
  and p_brand = 'Brand#23'
  and p_container = 'MED BOX'
  and l_quantity < (
    select
      0.2 * avg(l_quantity)
    from
      impala_tpch_lineitem
    where
      l_partkey = p_partkey
  )
PREHOOK: type: QUERY
PREHOOK: Input: default@impala_tpch_lineitem
PREHOOK: Input: default@impala_tpch_part
PREHOOK: Output: streaming
POSTHOOK: query: explain select
  sum(l_extendedprice) / 7.0 as avg_yearly
from
  impala_tpch_lineitem,
  impala_tpch_part
where
  p_partkey = l_partkey
  and p_brand = 'Brand#23'
  and p_container = 'MED BOX'
  and l_quantity < (
    select
      0.2 * avg(l_quantity)
    from
      impala_tpch_lineitem
    where
      l_partkey = p_partkey
  )
POSTHOOK: type: QUERY
POSTHOOK: Input: default@impala_tpch_lineitem
POSTHOOK: Input: default@impala_tpch_part
STAGE DEPENDENCIES:
  Stage-1 is a root stage
  Stage-0 is a root stage

STAGE PLANS:
  Stage: Stage-1
    Impala
      Impala Plan: 
F04:PLAN FRAGMENT [UNPARTITIONED] hosts=1 instances=1
Per-Host Resources: mem-estimate=10.02MB mem-reservation=0B thread-reservation=1
  PLAN-ROOT SINK
  |  output exprs: divide(_impala_builtins.sum(default.impala_tpch_lineitem.l_extendedprice), CAST(7 AS DECIMAL(1,0)))
  |  mem-estimate=0B mem-reservation=0B thread-reservation=0
  |
  12:AGGREGATE [FINALIZE]
  |  output: _impala_builtins.sum:merge(default.impala_tpch_lineitem.l_extendedprice)
  |  mem-estimate=10.00MB mem-reservation=0B spill-buffer=2.00MB thread-reservation=0
  |  tuple-ids=7 row-size=16B cardinality=1
  |  in pipelines: 12(GETNEXT), 06(OPEN)
  |
  11:EXCHANGE [UNPARTITIONED]
     mem-estimate=16.00KB mem-reservation=0B thread-reservation=0
     tuple-ids=7 row-size=16B cardinality=1
     in pipelines: 06(GETNEXT)

F00:PLAN FRAGMENT [RANDOM] hosts=1 instances=1
Per-Host Resources: mem-estimate=13.88MB mem-reservation=3.88MB thread-reservation=1
  DATASTREAM SINK [FRAGMENT=F04, EXCHANGE=11, UNPARTITIONED]
  |  mem-estimate=0B mem-reservation=0B thread-reservation=0
  06:AGGREGATE
  |  output: sum(default.impala_tpch_lineitem.l_extendedprice)
  |  mem-estimate=10.00MB mem-reservation=0B spill-buffer=2.00MB thread-reservation=0
  |  tuple-ids=7 row-size=16B cardinality=1
  |  in pipelines: 06(GETNEXT), 00(OPEN)
  |
  05:HASH JOIN [INNER JOIN, BROADCAST]
  |  hash predicates: default.impala_tpch_part.p_partkey = default.impala_tpch_lineitem_0.l_partkey
  |  fk/pk conjuncts: assumed fk/pk
  |  other join predicates: default.impala_tpch_lineitem.l_quantity < multiply(CAST(0.2 AS DECIMAL(1,1)), casttodecimal(divide(_impala_builtins.sum(default.impala_tpch_lineitem_0.l_quantity), casttodecimal(_impala_builtins.count(default.impala_tpch_lineitem_0.l_quantity)))))
  |  mem-estimate=1.94MB mem-reservation=1.94MB spill-buffer=64.00KB thread-reservation=0
  |  tuple-ids=0,2,6 row-size=88B cardinality=0
  |  in pipelines: 00(GETNEXT), 09(OPEN)
  |
  |--10:EXCHANGE [BROADCAST]
  |     mem-estimate=36.00KB mem-reservation=0B thread-reservation=0
  |     tuple-ids=6 row-size=32B cardinality=0
  |     in pipelines: 09(GETNEXT)
  |
  02:HASH JOIN [INNER JOIN, BROADCAST]
  |  hash predicates: default.impala_tpch_lineitem.l_partkey = default.impala_tpch_part.p_partkey
  |  fk/pk conjuncts: assumed fk/pk
  |  mem-estimate=1.94MB mem-reservation=1.94MB spill-buffer=64.00KB thread-reservation=0
  |  tuple-ids=0,2 row-size=56B cardinality=0
  |  in pipelines: 00(GETNEXT), 01(OPEN)
  |
  |--07:EXCHANGE [BROADCAST]
  |     mem-estimate=36.00KB mem-reservation=0B thread-reservation=0
  |     tuple-ids=2 row-size=32B cardinality=0
  |     in pipelines: 01(GETNEXT)
  |
  00:SCAN HDFS [default.impala_tpch_lineitem, RANDOM]
     HDFS partitions=1/1 files=0 size=0B
     predicates: default.impala_tpch_lineitem.l_partkey IS NOT NULL, default.impala_tpch_lineitem.l_quantity IS NOT NULL
     stored statistics:
       table: rows=unavailable size=unavailable
       columns: unavailable
     extrapolated-rows=disabled max-scan-range-rows=0
     mem-estimate=0B mem-reservation=0B thread-reservation=0
     tuple-ids=0 row-size=24B cardinality=0
     in pipelines: 00(GETNEXT)

F01:PLAN FRAGMENT [RANDOM] hosts=1 instances=1
Per-Host Resources: mem-estimate=0B mem-reservation=0B thread-reservation=1
  DATASTREAM SINK [FRAGMENT=F00, EXCHANGE=07, BROADCAST]
  |  mem-estimate=0B mem-reservation=0B thread-reservation=0
  01:SCAN HDFS [default.impala_tpch_part, RANDOM]
     HDFS partitions=1/1 files=0 size=0B
     predicates: default.impala_tpch_part.p_partkey IS NOT NULL, default.impala_tpch_part.p_container = 'MED BOX', default.impala_tpch_part.p_brand = 'Brand#23'
     stored statistics:
       table: rows=unavailable size=unavailable
       columns: unavailable
     extrapolated-rows=disabled max-scan-range-rows=0
     parquet statistics predicates: default.impala_tpch_part.p_container = 'MED BOX', default.impala_tpch_part.p_brand = 'Brand#23'
     mem-estimate=0B mem-reservation=0B thread-reservation=0
     tuple-ids=2 row-size=32B cardinality=0
     in pipelines: 01(GETNEXT)

F03:PLAN FRAGMENT [HASH(default.impala_tpch_lineitem_0.l_partkey)] hosts=1 instances=1
Per-Host Resources: mem-estimate=128.04MB mem-reservation=34.00MB thread-reservation=1
  DATASTREAM SINK [FRAGMENT=F00, EXCHANGE=10, BROADCAST]
  |  mem-estimate=0B mem-reservation=0B thread-reservation=0
  09:AGGREGATE [FINALIZE]
  |  output: _impala_builtins.sum:merge(default.impala_tpch_lineitem_0.l_quantity), _impala_builtins.count:merge(default.impala_tpch_lineitem_0.l_quantity)
  |  group by: default.impala_tpch_lineitem_0.l_partkey
  |  having: casttodecimal(divide(_impala_builtins.sum(default.impala_tpch_lineitem_0.l_quantity), casttodecimal(_impala_builtins.count(default.impala_tpch_lineitem_0.l_quantity)))) IS NOT NULL
  |  mem-estimate=128.00MB mem-reservation=34.00MB spill-buffer=2.00MB thread-reservation=0
  |  tuple-ids=6 row-size=32B cardinality=0
  |  in pipelines: 09(GETNEXT), 03(OPEN)
  |
  08:EXCHANGE [HASH(default.impala_tpch_lineitem_0.l_partkey)]
     mem-estimate=36.00KB mem-reservation=0B thread-reservation=0
     tuple-ids=6 row-size=32B cardinality=0
     in pipelines: 03(GETNEXT)

F02:PLAN FRAGMENT [RANDOM] hosts=1 instances=1
Per-Host Resources: mem-estimate=128.00MB mem-reservation=34.00MB thread-reservation=1
  DATASTREAM SINK [FRAGMENT=F03, EXCHANGE=08, HASH(default.impala_tpch_lineitem_0.l_partkey)]
  |  mem-estimate=0B mem-reservation=0B thread-reservation=0
  04:AGGREGATE [STREAMING]
  |  output: sum(default.impala_tpch_lineitem_0.l_quantity), count(default.impala_tpch_lineitem_0.l_quantity)
  |  group by: default.impala_tpch_lineitem_0.l_partkey
  |  mem-estimate=128.00MB mem-reservation=34.00MB spill-buffer=2.00MB thread-reservation=0
  |  tuple-ids=6 row-size=32B cardinality=0
  |  in pipelines: 03(GETNEXT)
  |
  03:SCAN HDFS [default.impala_tpch_lineitem, RANDOM]
     HDFS partitions=1/1 files=0 size=0B
     predicates: default.impala_tpch_lineitem_0.l_partkey IS NOT NULL
     stored statistics:
       table: rows=unavailable size=unavailable
       columns: unavailable
     extrapolated-rows=disabled max-scan-range-rows=0
     mem-estimate=0B mem-reservation=0B thread-reservation=0
     tuple-ids=4 row-size=16B cardinality=0
     in pipelines: 03(GETNEXT)


  Stage: Stage-0
    Fetch Operator
      limit: -1
      Processor Tree:
        ListSink

