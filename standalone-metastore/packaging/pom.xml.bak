<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
  <modelVersion>4.0.0</modelVersion>
  <parent>
    <groupId>org.apache.hive</groupId>
    <artifactId>hive-standalone-metastore</artifactId>
    <version>4.3.0-SNAPSHOT</version>
    <relativePath>../pom.xml</relativePath>
  </parent>
  <artifactId>hive-metastore-packaging</artifactId>
  <packaging>pom</packaging>
  <name>Hive Metastore Packaging</name>
  <properties>
    <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
    <standalone.metastore.path.to.root>..</standalone.metastore.path.to.root>
    <maven.license.plugin.version>2.3.0</maven.license.plugin.version>
  </properties>
  <profiles>
    <profile>
      <id>dist</id>
      <build>
        <plugins>
          <!-- plugins are always listed in sorted order by groupId, artifactId -->
          <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-assembly-plugin</artifactId>
            <executions>
              <execution>
                <id>assemble</id>
                <phase>package</phase>
                <goals>
                  <goal>single</goal>
                </goals>
                <configuration>
                  <finalName>${project.parent.artifactId}-${project.version}</finalName>
                  <descriptors>
                    <descriptor>src/assembly/bin.xml</descriptor>
                    <descriptor>src/assembly/src.xml</descriptor>
                  </descriptors>
                  <tarLongFileMode>posix</tarLongFileMode>
                </configuration>
              </execution>
            </executions>
          </plugin>
          <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-antrun-plugin</artifactId>
            <executions>
              <execution>
                <id>create-bin-license</id>
                <phase>generate-resources</phase>
                <goals>
                  <goal>run</goal>
                </goals>
                <configuration>
                  <target>
                    <concat destfile="${project.build.directory}/generated-resources/LICENSE" force="yes">
                      <fileset dir="../">
                        <include name="LICENSE"/>
                        <include name="LICENSE-binary"/>
                      </fileset>
                    </concat>
                  </target>
                </configuration>
              </execution>
            </executions>
          </plugin>
          <plugin>
            <groupId>org.codehaus.mojo</groupId>
            <artifactId>license-maven-plugin</artifactId>
            <version>${maven.license.plugin.version}</version>
            <executions>
              <execution>
                <id>license-fetch</id>
                <phase>generate-resources</phase>
                <goals>
                  <goal>download-licenses</goal>
                </goals>
              </execution>
            </executions>
            <configuration>
              <includeOptional>false</includeOptional>
              <artifactFiltersUrl>${project.baseUri}/src/license/artifact-filters.txt</artifactFiltersUrl>
              <excludeTransitiveDependencies>true</excludeTransitiveDependencies>
              <useDefaultUrlReplacements>true</useDefaultUrlReplacements>
              <licenseUrlReplacements>
                <licenseUrlReplacements>
                  <regexp>https?://glassfish(.dev)?\.java\.net/.*CDDL.*</regexp>
                  <replacement>https://spdx.org/licenses/CDDL-1.1.html</replacement>
                </licenseUrlReplacements>
                <licenseUrlReplacement>
                  <regexp>https?://asm\.objectweb\.org/license.html</regexp>
                  <replacement>https://asm.ow2.io/license.html</replacement>
                </licenseUrlReplacement>
                <licenseUrlReplacement>
                  <regexp>http://(www\.)?antlr.org/license.html</regexp>
                  <replacement>http://www.antlr.org/license.html</replacement>
                </licenseUrlReplacement>
              </licenseUrlReplacements>
              <licenseUrlFileNames>
                <APACHE-2.0>
                  https?://www\.apache\.org/licenses/LICENSE-2\.0.*
                  \Qhttps://aws.amazon.com/apache2.0\E
                  \Qhttps://opensource.org/licenses/Apache-2.0\E
                  \Qhttp://www.apache.org/licenses/\E
                </APACHE-2.0>
                <BSD-2-CLAUSE>
                  https?://(www\.)?opensource.org/licenses/bsd-license.php
                  https?://(www\.)?opensource.org/licenses/BSD-2-Clause
                </BSD-2-CLAUSE>
                <BSD-3-CLAUSE>
                  https?://(www\.)?opensource.org/licenses/BSD-3-Clause
                </BSD-3-CLAUSE>
                <LGPL-3.0-only>
                  \Qhttp://www.fsf.org/licensing/licenses/lgpl.txt\E
                  \Qhttp://www.gnu.org/licenses/lgpl-3.0.txt\E
                </LGPL-3.0-only>
                <EPL-1.0>
                  \Qhttps://www.eclipse.org/org/documents/epl-v10.php\E
                  \Qhttp://www.eclipse.org/org/documents/epl-v10.php\E
                </EPL-1.0>
                <EPL-2.0>
                  \Qhttps://raw.githubusercontent.com/locationtech/jts/master/LICENSE_EPLv2.txt\E
                  \Qhttps://www.eclipse.org/org/documents/epl-2.0/EPL-2.0.txt\E
                </EPL-2.0>
                <EDL-1.0>
                  \Qhttps://www.eclipse.org/org/documents/edl-v10.php\E
                  \Qhttp://www.eclipse.org/org/documents/edl-v10.php\E
                </EDL-1.0>
                <MIT>
                  https?://(www\.)?opensource\.org/licenses/mit(-license.php)?
                </MIT>
              </licenseUrlFileNames>
              <licenseUrlFileNameSanitizers>
                <licenseUrlFileNameSanitizer>
                  <regexp>[\s-_,]+</regexp>
                  <replacement>-</replacement>
                </licenseUrlFileNameSanitizer>
              </licenseUrlFileNameSanitizers>
            </configuration>
          </plugin>
        </plugins>
      </build>
    </profile>
    <profile>
      <id>docker</id>
      <build>
        <plugins>
          <plugin>
            <groupId>org.codehaus.mojo</groupId>
            <artifactId>exec-maven-plugin</artifactId>
            <executions>
              <execution>
                <phase>package</phase>
                <goals>
                  <goal>exec</goal>
                </goals>
                <configuration>
                  <executable>bash</executable>
                  <environmentVariables>
                    <SOURCE_DIR>${standalone.metastore.path.to.root}</SOURCE_DIR>
                  </environmentVariables>
                  <arguments>
                    <argument>src/docker/build.sh</argument>
                    <argument>-hadoop ${hadoop.version}</argument>
                  </arguments>
                </configuration>
              </execution>
            </executions>
          </plugin>
        </plugins>
      </build>
    </profile>
  </profiles>
  <dependencies>
    <dependency>
      <groupId>org.apache.hive</groupId>
      <artifactId>hive-metastore</artifactId>
      <version>${hive.version}</version>
    </dependency>
    <dependency>
      <groupId>org.apache.hive</groupId>
      <artifactId>hive-standalone-metastore-rest-catalog</artifactId>
      <version>${project.version}</version>
      <exclusions>
        <exclusion>
          <groupId>org.apache.hive</groupId>
          <artifactId>hive-iceberg-catalog</artifactId>
        </exclusion>
      </exclusions>
    </dependency>
    <dependency>
      <groupId>org.apache.hive</groupId>
      <artifactId>hive-exec</artifactId>
      <version>${hive.version}</version>
      <classifier>core</classifier>
    </dependency>
    <dependency>
      <groupId>org.apache.hive</groupId>
      <artifactId>hive-iceberg-handler</artifactId>
      <version>${hive.version}</version>
      <exclusions>
        <exclusion>
          <groupId>org.apache.hive</groupId>
          <artifactId>hive-exec</artifactId>
        </exclusion>
      </exclusions>
    </dependency>
    <dependency>
      <groupId>org.apache.hive</groupId>
      <artifactId>hive-standalone-metastore-common</artifactId>
      <version>${project.version}</version>
    </dependency>
    <dependency>
      <groupId>org.apache.hive</groupId>
      <artifactId>hive-standalone-metastore-server</artifactId>
      <version>${project.version}</version>
    </dependency>
  </dependencies>
</project>
